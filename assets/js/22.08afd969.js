(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{356:function(s,a,t){"use strict";t.r(a);var e=t(4),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"mysql-运维"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-运维"}},[s._v("#")]),s._v(" Mysql 运维")]),s._v(" "),a("blockquote",[a("p",[s._v("如果你的公司有 DBA，那么我恭喜你，你可以无视 Mysql 运维。如果你的公司没有 DBA，那你就好好学两手 Mysql 基本运维操作，行走江湖，防身必备。")])]),s._v(" "),a("h2",{attrs:{id:"_1-安装部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装部署"}},[s._v("#")]),s._v(" 1. 安装部署")]),s._v(" "),a("h3",{attrs:{id:"_1-1-windows-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-windows-安装"}},[s._v("#")]),s._v(" 1.1. Windows 安装")]),s._v(" "),a("p",[s._v("（1）下载 Mysql 5.7 免安装版")]),s._v(" "),a("p",[s._v("下载地址：https://dev.mysql.com/downloads/mysql/5.7.html#downloads")]),s._v(" "),a("p",[s._v("（2）解压并创建 my.ini 在根目录")]),s._v(" "),a("p",[s._v("my.ini 文件示例：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置3306端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("3306")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置mysql的安装目录 这块换成自己解压的路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("basedir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许最大连接数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("max_connections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务端使用的字符集默认为8比特编码的latin1字符集")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("character-set-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("utf8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建新表时将使用的默认存储引擎")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("default-storage-engine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("INNODB")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置mysql客户端默认字符集")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("default-character-set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("utf8")]),s._v("\n")])])]),a("p",[s._v("（3）执行安装命令")]),s._v(" "),a("p",[s._v("在控制台 CMD 中依次执行以下安装命令")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31\nmysqld --initialize\nmysqld -install\n")])])]),a("p",[s._v("说明：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("mysqld --initialize")]),s._v(" 会自动初始化创建 data 文件夹并初始化 mysql。")]),s._v(" "),a("li",[a("code",[s._v("mysqld -install")]),s._v(" 会安装 mysql 服务。")])]),s._v(" "),a("p",[s._v("（4）启动服务")]),s._v(" "),a("p",[s._v("在控制台执行 "),a("code",[s._v("net start mysql")]),s._v(" 启动服务。")]),s._v(" "),a("h3",{attrs:{id:"_1-2-centos-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-centos-安装"}},[s._v("#")]),s._v(" 1.2. CentOS 安装")]),s._v(" "),a("blockquote",[a("p",[s._v("本文仅介绍 rpm 安装方式")])]),s._v(" "),a("h4",{attrs:{id:"安装-mysql-yum-源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql-yum-源"}},[s._v("#")]),s._v(" 安装 mysql yum 源")]),s._v(" "),a("p",[s._v("官方下载地址：https://dev.mysql.com/downloads/repo/yum/")]),s._v(" "),a("p",[s._v("（1）下载 yum 源")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n")])])]),a("p",[s._v("（2）安装 yum repo 文件并更新 yum 缓存")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" mysql80-community-release-el7-1.noarch.rpm\n")])])]),a("p",[s._v("执行结果：")]),s._v(" "),a("p",[s._v("会在 /etc/yum.repos.d/ 目录下生成两个 repo 文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysql\nmysql-community.repo\nmysql-community-source.repo\n")])])]),a("p",[s._v("更新 yum：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum clean all\nyum makecache\n")])])]),a("p",[s._v("（3）查看 rpm 安装状态")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ yum search mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" server\nmysql-community-common.i686 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MySQL database common files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" server and client\nmysql-community-common.x86_64 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MySQL database common files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" server and\nmysql-community-test.x86_64 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Test suite "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the MySQL database server\n                       "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" administering MySQL servers\nmysql-community-server.x86_64 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" A very fast and reliable SQL database server\n")])])]),a("p",[s._v("通过 yum 安装 mysql 有几个重要目录：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("## 配置文件\n/etc/my.cnf\n## 数据库目录\n/var/lib/mysql/\n## 配置文件\n/usr/share/mysql（mysql.server命令及配置文件）\n## 相关命令\n/usr/bin（mysqladmin mysqldump等命令）\n## 启动脚本\n/usr/lib/systemd/system/mysqld.service （注册为 systemd 服务）\n")])])]),a("p",[s._v("（4）安装 mysql 服务器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mysql-community-server\n")])])]),a("h4",{attrs:{id:"mysql-服务管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-服务管理"}},[s._v("#")]),s._v(" mysql 服务管理")]),s._v(" "),a("p",[s._v("通过 yum 方式安装 mysql 后，本地会有一个名为 "),a("code",[s._v("mysqld")]),s._v(" 的 systemd 服务。")]),s._v(" "),a("p",[s._v("其服务管理十分简便：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看状态")]),s._v("\nsystemctl status mysqld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 启用服务")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysqld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 禁用服务")]),s._v("\nsystemctl disable mysqld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 启动服务")]),s._v("\nsystemctl start mysqld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重启服务")]),s._v("\nsystemctl restart mysqld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 停止服务")]),s._v("\nsystemctl stop mysqld\n")])])]),a("h3",{attrs:{id:"_1-3-初始化数据库密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-初始化数据库密码"}},[s._v("#")]),s._v(" 1.3. 初始化数据库密码")]),s._v(" "),a("p",[s._v("查看一下初始密码")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),s._v(" /var/log/mysqld.log\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-09-30T03:13:41.727736Z "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MY-010454"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" A temporary password is generated "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" root@localhost: %:lt+srWu4k1\n")])])]),a("p",[s._v("执行命令：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" -p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("临时密码"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),a("p",[s._v("输入临时密码，进入 mysql，如果要修改密码，执行以下指令：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ALTER user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你的密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("注：密码强度默认为中等，大小写字母、数字、特殊符号，只有修改成功后才能修改配置再设置更简单的密码")]),s._v(" "),a("h3",{attrs:{id:"_1-4-配置远程访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-配置远程访问"}},[s._v("#")]),s._v(" 1.4. 配置远程访问")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你的密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你的密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFLUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_1-5-跳过登录认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-跳过登录认证"}},[s._v("#")]),s._v(" 1.5. 跳过登录认证")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf\n")])])]),a("p",[s._v("在 [mysqld] 下面加上 skip-grant-tables")]),s._v(" "),a("p",[s._v("作用是登录时跳过登录认证，换句话说就是 root 什么密码都可以登录进去。")]),s._v(" "),a("p",[s._v("执行 "),a("code",[s._v("systemctl restart mysqld")]),s._v("，重启 mysql")]),s._v(" "),a("h2",{attrs:{id:"_2-基本运维"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-基本运维"}},[s._v("#")]),s._v(" 2. 基本运维")]),s._v(" "),a("h3",{attrs:{id:"_2-1-客户端连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-客户端连接"}},[s._v("#")]),s._v(" 2.1. 客户端连接")]),s._v(" "),a("p",[s._v("语法："),a("code",[s._v("mysql -h<主机> -P<端口> -u<用户名> -p<密码>")])]),s._v(" "),a("p",[s._v("如果没有显式指定密码，会要求输入密码才能访问。")]),s._v(" "),a("p",[s._v("【示例】连接本地 Mysql")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\nEnter password:\nWelcome to the MySQL monitor.  Commands end with "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("g.\nYour MySQL connection "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" is "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13501")]),s._v("\nServer version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".19 MySQL Community Server - GPL\n\nCopyright "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(", Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help;'")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\h'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" help. Type "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\c'")]),s._v(" to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),s._v(" the current input statement.\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-2-查看连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-查看连接"}},[s._v("#")]),s._v(" 2.2. 查看连接")]),s._v(" "),a("p",[s._v("连接完成后，如果你没有后续的动作，这个连接就处于空闲状态，你可以在 "),a("code",[s._v("show processlist")]),s._v(" 命令中看到它。客户端如果太长时间没动静，连接器就会自动将它断开。这个时间是由参数 "),a("code",[s._v("wait_timeout")]),s._v(" 控制的，默认值是 8 小时。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20200714115031.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"_2-3-创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-创建用户"}},[s._v("#")]),s._v(" 2.3. 创建用户")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'host'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("说明：")]),s._v(" "),a("ul",[a("li",[s._v("username：你将创建的用户名")]),s._v(" "),a("li",[s._v("host：指定该用户在哪个主机上可以登陆，如果是本地用户可用 localhost，如果想让该用户可以"),a("strong",[s._v("从任意远程主机登陆")]),s._v("，可以使用通配符"),a("code",[s._v("%")])]),s._v(" "),a("li",[s._v("password：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器")])]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dog'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'192.168.1.101_'")]),s._v(" IDENDIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("注意：在 Mysql 8 中，默认密码验证不再是 "),a("code",[s._v("password")]),s._v("。所以在创建用户时，"),a("code",[s._v("create user 'username'@'%' identified by 'password';")]),s._v(" 客户端是无法连接服务的。")]),s._v(" "),a("p",[s._v("所以，需要加上 "),a("code",[s._v("IDENTIFIED WITH mysql_native_password")]),s._v("，例如："),a("code",[s._v("CREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY '123456';")])])]),s._v(" "),a("h3",{attrs:{id:"_2-4-查看用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-查看用户"}},[s._v("#")]),s._v(" 2.4. 查看用户")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看所有用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v(" CONCAT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User: '''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'''@'''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''';'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" query\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-5-授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-授权"}},[s._v("#")]),s._v(" 2.5. 授权")]),s._v(" "),a("p",[s._v("命令：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" databasename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'host'")]),s._v("\n")])])]),a("p",[s._v("说明：")]),s._v(" "),a("ul",[a("li",[s._v("privileges：用户的操作权限，如"),a("code",[s._v("SELECT")]),s._v("，"),a("code",[s._v("INSERT")]),s._v("，"),a("code",[s._v("UPDATE")]),s._v("等，如果要授予所的权限则使用"),a("code",[s._v("ALL")])]),s._v(" "),a("li",[s._v("databasename：数据库名")]),s._v(" "),a("li",[s._v("tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用"),a("code",[s._v("*")]),s._v("表示，如"),a("code",[s._v("*.*")])])]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" maindataplus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("注意：")]),s._v(" "),a("p",[s._v("用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 为指定用户配置指定权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" databasename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'host'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 为 root 用户分配所有权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-6-撤销授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-撤销授权"}},[s._v("#")]),s._v(" 2.6. 撤销授权")]),s._v(" "),a("p",[s._v("命令:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("REVOKE privilege ON databasename.tablename FROM 'username'@'host';\n")])])]),a("p",[s._v("说明:")]),s._v(" "),a("p",[s._v("privilege, databasename, tablename：同授权部分")]),s._v(" "),a("p",[s._v("例子:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REVOKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("注意:")]),s._v(" "),a("p",[s._v("假如你在给用户"),a("code",[s._v("'pig'@'%'")]),s._v("授权的时候是这样的（或类似的）："),a("code",[s._v("GRANT SELECT ON test.user TO 'pig'@'%'")]),s._v("，则在使用"),a("code",[s._v("REVOKE SELECT ON *.* FROM 'pig'@'%';")]),s._v("命令并不能撤销该用户对 test 数据库中 user 表的"),a("code",[s._v("SELECT")]),s._v(" 操作。相反，如果授权使用的是"),a("code",[s._v("GRANT SELECT ON *.* TO 'pig'@'%';")]),s._v("则"),a("code",[s._v("REVOKE SELECT ON test.user FROM 'pig'@'%';")]),s._v("命令也不能撤销该用户对 test 数据库中 user 表的"),a("code",[s._v("Select")]),s._v("权限。")]),s._v(" "),a("p",[s._v("具体信息可以用命令"),a("code",[s._v("SHOW GRANTS FOR 'pig'@'%';")]),s._v(" 查看。")]),s._v(" "),a("h3",{attrs:{id:"_2-7-查看授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-查看授权"}},[s._v("#")]),s._v(" 2.7. 查看授权")]),s._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看用户权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" GRANTS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-8-更改用户密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-更改用户密码"}},[s._v("#")]),s._v(" 2.8. 更改用户密码")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" PASSWORD "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'host'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'newpassword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("如果是当前登陆用户用:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" PASSWORD "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"newpassword"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" PASSWORD "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pig'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-9-备份与恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-9-备份与恢复"}},[s._v("#")]),s._v(" 2.9. 备份与恢复")]),s._v(" "),a("p",[s._v("Mysql 备份数据使用 mysqldump 命令。")]),s._v(" "),a("p",[s._v("mysqldump 将数据库中的数据备份成一个文本文件，表的结构和表中的数据将存储在生成的文本文件中。")]),s._v(" "),a("p",[s._v("备份：")]),s._v(" "),a("h4",{attrs:{id:"备份一个数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份一个数据库"}},[s._v("#")]),s._v(" 备份一个数据库")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldump "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("table1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("table2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("backup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n")])])]),a("ul",[a("li",[a("strong",[a("code",[s._v("host")])]),s._v(" - Mysql Server 的 host")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("port")])]),s._v(" - Mysql Server 的端口")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("username")])]),s._v(" - 数据库用户")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("dbname")])]),s._v(" - 数据库名称")]),s._v(" "),a("li",[s._v("table1 和 table2 参数表示需要备份的表的名称，为空则整个数据库备份；")]),s._v(" "),a("li",[s._v("BackupName.sql 参数表设计备份文件的名称，文件名前面可以加上一个绝对路径。通常将数据库被分成一个后缀名为 sql 的文件")])]),s._v(" "),a("h4",{attrs:{id:"备份多个数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份多个数据库"}},[s._v("#")]),s._v(" 备份多个数据库")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldump "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--databases <database1> <database2> ... > backup.sql")]),s._v("\n")])])]),a("h4",{attrs:{id:"备份所有数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份所有数据库"}},[s._v("#")]),s._v(" 备份所有数据库")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldump "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--all-databases > backup.sql")]),s._v("\n")])])]),a("h4",{attrs:{id:"恢复一个数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复一个数据库"}},[s._v("#")]),s._v(" 恢复一个数据库")]),s._v(" "),a("p",[s._v("Mysql 恢复数据使用 mysql 命令。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("backup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n")])])]),a("h4",{attrs:{id:"恢复所有数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复所有数据库"}},[s._v("#")]),s._v(" 恢复所有数据库")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--all-databases < backup.sql")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-10-卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-10-卸载"}},[s._v("#")]),s._v(" 2.10. 卸载")]),s._v(" "),a("p",[s._v("（1）查看已安装的 mysql")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-qa")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" mysql\nperl-DBD-MySQL-4.023-6.el7.x86_64\nmysql80-community-release-el7-1.noarch\nmysql-community-common-8.0.12-1.el7.x86_64\nmysql-community-client-8.0.12-1.el7.x86_64\nmysql-community-libs-compat-8.0.12-1.el7.x86_64\nmysql-community-libs-8.0.12-1.el7.x86_64\n")])])]),a("p",[s._v("（2）卸载 mysql")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum remove mysql-community-server.x86_64\n")])])]),a("h3",{attrs:{id:"_2-11-主从节点部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-11-主从节点部署"}},[s._v("#")]),s._v(" 2.11. 主从节点部署")]),s._v(" "),a("p",[s._v("假设需要配置一个主从 Mysql 服务器环境")]),s._v(" "),a("ul",[a("li",[s._v("master 节点：192.168.8.10")]),s._v(" "),a("li",[s._v("slave 节点：192.168.8.11")])]),s._v(" "),a("h4",{attrs:{id:"主节点上的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主节点上的操作"}},[s._v("#")]),s._v(" 主节点上的操作")]),s._v(" "),a("p",[s._v("（1）修改配置并重启")]),s._v(" "),a("p",[s._v("执行 "),a("code",[s._v("vi /etc/my.cnf")]),s._v(" ，添加如下配置：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server-id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log_bin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql/binlog")]),s._v("\n")])])]),a("ul",[a("li",[a("code",[s._v("server-id")]),s._v(" - 服务器 ID 号。在主从架构中，每台机器的 ID 必须唯一。")]),s._v(" "),a("li",[a("code",[s._v("log_bin")]),s._v(" - 同步的日志路径及文件名，一定注意这个目录要是 mysql 有权限写入的；")])]),s._v(" "),a("p",[s._v("修改后，重启 mysql 使配置生效：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("systemctl restart mysql\n")])])]),a("p",[s._v("（2）创建用于同步的用户")]),s._v(" "),a("p",[s._v("进入 mysql 命令控制台：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mysql -u root -p\nPassword:\n")])])]),a("p",[s._v("执行以下 SQL：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- a. 创建 slave 用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 为 slave 赋予 REPLICATION SLAVE 权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- b. 或者，创建 slave 用户，并指定该用户能在任意主机上登录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 如果有多个从节点，又想让所有从节点都使用统一的用户名、密码认证，可以考虑这种方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 刷新授权表信息")]),s._v("\nFLUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("注意：在 Mysql 8 中，默认密码验证不再是 "),a("code",[s._v("password")]),s._v("。所以在创建用户时，"),a("code",[s._v("create user 'username'@'%' identified by 'password';")]),s._v(" 客户端是无法连接服务的。所以，需要加上 "),a("code",[s._v("IDENTIFIED WITH mysql_native_password BY 'password'")])])]),s._v(" "),a("p",[s._v("补充用户管理 SQL:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看所有用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v(" CONCAT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User: '''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'''@'''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''';'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" query\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看用户权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" GRANTS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- a. 创建 slave 用户，并指定该用户只能在主机 192.168.8.11 上登录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'192.168.8.11'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 为 slave 赋予 REPLICATION SLAVE 权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'192.168.8.11'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 删除用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'192.168.8.11'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("（3）加读锁")]),s._v(" "),a("p",[s._v("为了主库与从库的数据保持一致，我们先为 mysql 加入读锁，使其变为只读。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" FLUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("READ")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOCK")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("（4）查看主节点状态")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+----------+--------------+---------------------------------------------+-------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("File")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Position "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Do_DB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Ignore_DB                            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Executed_Gtid_Set "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+----------+--------------+---------------------------------------------+-------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4202")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("performance_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+----------+--------------+---------------------------------------------+-------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("注意：需要记录下 "),a("code",[s._v("File")]),s._v(" 和 "),a("code",[s._v("Position")]),s._v("，后面会用到。")])]),s._v(" "),a("p",[s._v("（5）导出 sql")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysqldump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" --all-databases --master-data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dbdump.sql\n")])])]),a("p",[s._v("（6）解除读锁")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNLOCK")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("（7）将 sql 远程传送到从节点上")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("scp dbdump.sql root@192.168.8.11:/home\n")])])]),a("h4",{attrs:{id:"从节点上的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从节点上的操作"}},[s._v("#")]),s._v(" 从节点上的操作")]),s._v(" "),a("p",[s._v("（1）修改配置并重启")]),s._v(" "),a("p",[s._v("执行 "),a("code",[s._v("vi /etc/my.cnf")]),s._v(" ，添加如下配置：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server-id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log_bin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql/binlog")]),s._v("\n")])])]),a("ul",[a("li",[a("code",[s._v("server-id")]),s._v(" - 服务器 ID 号。在主从架构中，每台机器的 ID 必须唯一。")]),s._v(" "),a("li",[a("code",[s._v("log_bin")]),s._v(" - 同步的日志路径及文件名，一定注意这个目录要是 mysql 有权限写入的；")])]),s._v(" "),a("p",[s._v("修改后，重启 mysql 使配置生效：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl restart mysql\n")])])]),a("p",[s._v("（2）导入 sql")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /home/dbdump.sql\n")])])]),a("p",[s._v("（3）在从节点上建立与主节点的连接")]),s._v(" "),a("p",[s._v("进入 mysql 命令控制台：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mysql -u root -p\nPassword:\n")])])]),a("p",[s._v("执行以下 SQL：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 停止从节点服务")]),s._v("\nSTOP SLAVE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 注意：MASTER_USER 和")]),s._v("\nCHANGE MASTER "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v("\nMASTER_HOST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.8.10'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_USER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_PASSWORD"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_LOG_FILE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog.000001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_LOG_POS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4202")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("code",[s._v("MASTER_LOG_FILE")]),s._v(" 和 "),a("code",[s._v("MASTER_LOG_POS")]),s._v(" 参数要分别与 "),a("code",[s._v("show master status")]),s._v(" 指令获得的 "),a("code",[s._v("File")]),s._v(" 和 "),a("code",[s._v("Position")]),s._v(" 属性值对应。")]),s._v(" "),a("li",[a("code",[s._v("MASTER_HOST")]),s._v(" 是主节点的 HOST。")]),s._v(" "),a("li",[a("code",[s._v("MASTER_USER")]),s._v(" 和 "),a("code",[s._v("MASTER_PASSWORD")]),s._v(" 是在主节点上注册的用户及密码。")])]),s._v(" "),a("p",[s._v("（4）启动 slave 进程")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("（5）查看主从同步状态")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v("\\G"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("说明：如果以下两项参数均为 YES，说明配置正确。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Slave_IO_Running")])]),s._v(" "),a("li",[a("code",[s._v("Slave_SQL_Running")])])]),s._v(" "),a("p",[s._v("（6）将从节点设为只读")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" read_only"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" super_read_only"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%read_only%"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" innodb_read_only      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" read_only             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" super_read_only       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" transaction_read_only "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------------+-------+")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("注：设置 slave 服务器为只读，并不影响主从同步。")])]),s._v(" "),a("h2",{attrs:{id:"_3-服务器配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务器配置"}},[s._v("#")]),s._v(" 3. 服务器配置")]),s._v(" "),a("blockquote",[a("p",[a("strong",[a("em",[s._v("大部分情况下，默认的基本配置已经足够应付大多数场景，不要轻易修改 Mysql 服务器配置，除非你明确知道修改项是有益的。")])])]),s._v(" "),a("p",[s._v("尽量不要使用 Mysql 的缓存功能，因为其要求每次请求参数完全相同，才能命中缓存。这种方式实际上并不高效，还会增加额外开销，实际业务场景中一般使用 Redis 等 key-value 存储来解决缓存问题，性能远高于 Mysql 的查询缓存。")])]),s._v(" "),a("h3",{attrs:{id:"_3-1-配置文件路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-配置文件路径"}},[s._v("#")]),s._v(" 3.1. 配置文件路径")]),s._v(" "),a("p",[s._v("配置 Mysql 首先要确定配置文件在哪儿。")]),s._v(" "),a("p",[s._v("不同 Linux 操作系统上，Mysql 配置文件路径可能不同。通常的路径为 /etc/my.cnf 或 /etc/mysql/my.cnf 。")]),s._v(" "),a("p",[s._v("如果不知道配置文件路径，可以尝试以下操作：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# which mysqld")]),s._v("\n/usr/sbin/mysqld\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/sbin/mysqld --verbose --help | grep -A 1 'Default options'")]),s._v("\nDefault options are "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" from the following files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf\n")])])]),a("h3",{attrs:{id:"_3-2-配置项语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-配置项语法"}},[s._v("#")]),s._v(" 3.2. 配置项语法")]),s._v(" "),a("p",[a("strong",[s._v("Mysql 配置项设置都使用小写，单词之间用下划线或横线隔开（二者是等价的）。")])]),s._v(" "),a("p",[s._v("建议使用固定的风格，这样检索配置项时较为方便。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这两种格式等价")]),s._v("\n/usr/sbin/mysqld --auto-increment-offset"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n/usr/sbin/mysqld "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--auto_increment_offset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-3-常用配置项说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-常用配置项说明"}},[s._v("#")]),s._v(" 3.3. 常用配置项说明")]),s._v(" "),a("blockquote",[a("p",[s._v("这里介绍比较常用的基本配置，更多配置项说明可以参考："),a("RouterLink",{attrs:{to:"/12.数据库/03.关系型数据库/02.Mysql/21.Mysql配置.html"}},[s._v("Mysql 服务器配置说明")])],1)]),s._v(" "),a("p",[s._v("先给出一份常用配置模板，内容如下：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GENERAL")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------------------------------------------------------")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("datadir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("socket")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql/mysql.sock")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("pid_file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql/mysql.pid")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("mysql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("3306")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("default_storage_engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("InnoDB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("default_time_zone")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("+8:00")]),s._v("'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("character_set_server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("utf8mb4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("collation_server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("utf8mb4_0900_ai_ci")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LOG")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------------------------------------------------------")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log_error")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/log/mysql/mysql-error.log")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("slow_query_log")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("slow_query_log_file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/log/mysql/mysql-slow.log")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# InnoDB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------------------------------------------------------")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("innodb_buffer_pool_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("<value>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("innodb_log_file_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("<value>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("innodb_file_per_table")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("innodb_flush_method")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("O_DIRECT")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MyIsam")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------------------------------------------------------")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("key_buffer_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("<value>")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OTHER")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -------------------------------------------------------------------------------")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("tmp_table_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("32M")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("max_heap_table_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("32M")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("query_cache_type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("query_cache_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("max_connections")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("<value>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("thread_cache")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("<value>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("open_files_limit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("65535")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("socket")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/mysql/mysql.sock")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("3306")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[s._v("GENERAL")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("datadir")]),s._v(" - mysql 数据文件所在目录")]),s._v(" "),a("li",[a("code",[s._v("socket")]),s._v(" - scoket 文件")]),s._v(" "),a("li",[a("code",[s._v("pid_file")]),s._v(" - PID 文件")]),s._v(" "),a("li",[a("code",[s._v("user")]),s._v(" - 启动 mysql 服务进程的用户")]),s._v(" "),a("li",[a("code",[s._v("port")]),s._v(" - 服务端口号，默认 "),a("code",[s._v("3306")])]),s._v(" "),a("li",[a("code",[s._v("default_storage_engine")]),s._v(" - mysql 5.1 之后，默认引擎是 InnoDB")]),s._v(" "),a("li",[a("code",[s._v("default_time_zone")]),s._v(" - 默认时区。中国大部分地区在东八区，即 "),a("code",[s._v("+8:00")])]),s._v(" "),a("li",[a("code",[s._v("character_set_server")]),s._v(" - 数据库默认字符集")]),s._v(" "),a("li",[a("code",[s._v("collation_server")]),s._v(" - 数据库字符集对应一些排序等规则，注意要和 "),a("code",[s._v("character_set_server")]),s._v(" 对应")])])]),s._v(" "),a("li",[a("p",[s._v("LOG")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("log_error")]),s._v(" - 错误日志文件地址")]),s._v(" "),a("li",[a("code",[s._v("slow_query_log")]),s._v(" - 错误日志文件地址")])])]),s._v(" "),a("li",[a("p",[s._v("InnoDB")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("innodb_buffer_pool_size")]),s._v(" - InnoDB 使用一个缓冲池来保存索引和原始数据，不像 MyISAM。这里你设置越大，你在存取表里面数据时所需要的磁盘 I/O 越少。\n"),a("ul",[a("li",[s._v("在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的 60%-80%")]),s._v(" "),a("li",[s._v("注意别设置的过大，会导致 system 的 swap 空间被占用，导致操作系统变慢，从而减低 sql 查询的效率")]),s._v(" "),a("li",[s._v("默认值：128M，建议值：物理内存的 60%-80%")])])]),s._v(" "),a("li",[a("code",[s._v("innodb_log_file_size")]),s._v(" - 日志文件的大小。默认值：48M，建议值：根据你系统的磁盘空间和日志增长情况调整大小")]),s._v(" "),a("li",[a("code",[s._v("innodb_file_per_table")]),s._v(" - 说明：mysql5.7 之后默认开启，意思是，每张表一个独立表空间。默认值 1，开启。")]),s._v(" "),a("li",[a("code",[s._v("innodb_flush_method")]),s._v(" - 说明：控制着 innodb 数据文件及 redo log 的打开、刷写模式，三种模式：fdatasync(默认)，O_DSYNC，O_DIRECT。默认值为空，建议值：使用 SAN 或者 raid，建议用 O_DIRECT，不懂测试的话，默认生产上使用 O_DIRECT\n"),a("ul",[a("li",[a("code",[s._v("fdatasync")]),s._v("：数据文件，buffer pool->os buffer->磁盘；日志文件，buffer pool->os buffer->磁盘；")]),s._v(" "),a("li",[a("code",[s._v("O_DSYNC")]),s._v("： 数据文件，buffer pool->os buffer->磁盘；日志文件，buffer pool->磁盘；")]),s._v(" "),a("li",[a("code",[s._v("O_DIRECT")]),s._v("： 数据文件，buffer pool->磁盘； 日志文件，buffer pool->os buffer->磁盘；")])])])])]),s._v(" "),a("li",[a("p",[s._v("MyIsam")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("key_buffer_size")]),s._v(" - 指定索引缓冲区的大小，为 MYISAM 数据表开启供线程共享的索引缓存，对 INNODB 引擎无效。相当影响 MyISAM 的性能。\n"),a("ul",[a("li",[s._v("不要将其设置大于你可用内存的 30%，因为一部分内存同样被 OS 用来缓冲行数据")]),s._v(" "),a("li",[s._v("甚至在你并不使用 MyISAM 表的情况下，你也需要仍旧设置起 8-64M 内存由于它同样会被内部临时磁盘表使用。")]),s._v(" "),a("li",[s._v("默认值 8M，建议值：对于内存在 4GB 左右的服务器该参数可设置为 256M 或 384M。")]),s._v(" "),a("li",[s._v("注意：该参数值设置的过大反而会是服务器整体效率降低！")])])])])]),s._v(" "),a("li",[a("p",[s._v("OTHER")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("tmp_table_size")]),s._v(" - 内存临时表的最大值，默认 16M，此处设置成 128M")]),s._v(" "),a("li",[a("code",[s._v("max_heap_table_size")]),s._v(" - 用户创建的内存表的大小，默认 16M，往往和 "),a("code",[s._v("tmp_table_size")]),s._v(" 一起设置，限制用户临时表大小。超限的话，MySQL 就会自动地把它转化为基于磁盘的 MyISAM 表，存储在指定的 tmpdir 目录下，增大 IO 压力，建议内存大，增大该数值。")]),s._v(" "),a("li",[a("code",[s._v("query_cache_type")]),s._v(" - 这个系统变量控制着查询缓存功能的开启和关闭，0 表示关闭，1 表示打开，2 表示只要 "),a("code",[s._v("select")]),s._v(" 中明确指定 "),a("code",[s._v("SQL_CACHE")]),s._v(" 才缓存。")]),s._v(" "),a("li",[a("code",[s._v("query_cache_size")]),s._v(" - 默认值 1M，优点是查询缓存可以极大的提高服务器速度，如果你有大量的相同的查询并且很少修改表。缺点：在你表经常变化的情况下或者如果你的查询原文每次都不同，查询缓存也许引起性能下降而不是性能提升。")]),s._v(" "),a("li",[a("code",[s._v("max_connections")]),s._v(" - 最大连接数，可设最大值 16384，一般考虑根据同时在线人数设置一个比较综合的数字，鉴于该数值增大并不太消耗系统资源，建议直接设 10000。如果在访问时经常出现 Too Many Connections 的错误提示，则需要增大该参数值")]),s._v(" "),a("li",[a("code",[s._v("thread_cache")]),s._v(" - 当客户端断开之后，服务器处理此客户的线程将会缓存起来以响应下一个客户而不是销毁。可重用，减小了系统开销。默认值为 9，建议值：两种取值方式，\n"),a("ul",[a("li",[s._v("方式一，根据物理内存，1G —> 8；2G —> 16； 3G —> 32； >3G —> 64；")]),s._v(" "),a("li",[s._v("方式二，根据 show status like 'threads%'，查看 Threads_connected 值。")])])]),s._v(" "),a("li",[a("code",[s._v("open_files_limit")]),s._v(" - MySQL 打开的文件描述符限制，默认最小 1024;\n"),a("ul",[a("li",[s._v("当 open_files_limit 没有被配置的时候，比较 max_connections*5 和 ulimit -n 的值，哪个大用哪个，")]),s._v(" "),a("li",[s._v("当 open_file_limit 被配置的时候，比较 open_files_limit 和 max_connections*5 的值，哪个大用哪个")]),s._v(" "),a("li",[s._v("注意：仍然可能出现报错信息 Can't create a new thread；此时观察系统 "),a("code",[s._v("cat /proc/mysql")]),s._v(" 进程号/limits，观察进程 ulimit 限制情况")]),s._v(" "),a("li",[s._v("过小的话，考虑修改系统配置表，"),a("code",[s._v("/etc/security/limits.conf")]),s._v(" 和 "),a("code",[s._v("/etc/security/limits.d/90-nproc.conf")])])])])])])]),s._v(" "),a("h2",{attrs:{id:"_4-常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-常见问题"}},[s._v("#")]),s._v(" 4. 常见问题")]),s._v(" "),a("h3",{attrs:{id:"_4-1-too-many-connections"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-too-many-connections"}},[s._v("#")]),s._v(" 4.1. Too many connections")]),s._v(" "),a("p",[a("strong",[s._v("现象")])]),s._v(" "),a("p",[s._v("尝试连接 Mysql 时，遇到 "),a("code",[s._v("Too many connections")]),s._v(" 错误。")]),s._v(" "),a("p",[a("strong",[s._v("原因")])]),s._v(" "),a("p",[s._v("数据库连接线程数超过最大值，访问被拒绝。")]),s._v(" "),a("p",[a("strong",[s._v("解决方案")])]),s._v(" "),a("p",[s._v("如果实际连接线程数过大，可以考虑增加服务器节点来分流；如果实际线程数并不算过大，那么可以配置 "),a("code",[s._v("max_connections")]),s._v(" 来增加允许的最大连接数。需要注意的是，连接数不宜过大，一般来说，单库每秒有 2000 个并发连接时，就可以考虑扩容了，健康的状态应该维持在每秒 1000 个并发连接左右。")]),s._v(" "),a("p",[s._v("（1）查看最大连接数")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%max_connections%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" max_connections        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("151")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysqlx_max_connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------+-------+")]),s._v("\n")])])]),a("p",[s._v("（2）查看服务器响应的最大连接数")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Max_used_connections'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Max_used_connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("142")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("（3）临时设置最大连接数")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" max_connections"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("注意：当服务器重启时，最大连接数会被重置。")]),s._v(" "),a("p",[s._v("（4）永久设置最大连接数")]),s._v(" "),a("p",[s._v("修改 "),a("code",[s._v("/etc/my.cnf")]),s._v(" 配置文件，在 "),a("code",[s._v("[mysqld]")]),s._v(" 添加以下配置：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("max_connections"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n")])])]),a("p",[s._v("重启 mysql 以生效")]),s._v(" "),a("p",[s._v("（5）修改 Linux 最大文件数限制")]),s._v(" "),a("p",[s._v("设置了最大连接数，如果还是没有生效，考虑检查一下 Linux 最大文件数")]),s._v(" "),a("p",[s._v("Mysql 最大连接数会受到最大文件数限制，"),a("code",[s._v("vim /etc/security/limits.conf")]),s._v("，添加 mysql 用户配置")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mysql hard nofile 65535\nmysql soft nofile 65535\n")])])]),a("p",[s._v("（6）检查 LimitNOFILE")]),s._v(" "),a("p",[s._v("如果是使用 rpm 方式安装 mysql，检查 "),a("strong",[s._v("mysqld.service")]),s._v(" 文件中的 "),a("code",[s._v("LimitNOFILE")]),s._v(" 是否配置的太小。")]),s._v(" "),a("h3",{attrs:{id:"_4-2-时区-time-zone-偏差"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-时区-time-zone-偏差"}},[s._v("#")]),s._v(" 4.2. 时区（time_zone）偏差")]),s._v(" "),a("p",[a("strong",[s._v("现象")])]),s._v(" "),a("p",[s._v("数据库中存储的 Timestamp 字段值比真实值少了 13 个小时。")]),s._v(" "),a("p",[a("strong",[s._v("原因")])]),s._v(" "),a("ul",[a("li",[s._v("当 JDBC 与 MySQL 开始建立连接时，会获取服务器参数。")]),s._v(" "),a("li",[s._v("当 MySQL 的 "),a("code",[s._v("time_zone")]),s._v(" 值为 "),a("code",[s._v("SYSTEM")]),s._v(" 时，会取 "),a("code",[s._v("system_time_zone")]),s._v(" 值作为协调时区，若得到的是 "),a("code",[s._v("CST")]),s._v(" 那么 Java 会误以为这是 "),a("code",[s._v("CST -0500")]),s._v(" ，因此会给出错误的时区信息（国内一般是"),a("code",[s._v("CST +0800")]),s._v("，即东八区）。")])]),s._v(" "),a("p",[s._v("查看时区方法：")]),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("show variables like '%time_zone%';")]),s._v(" 命令查看 Mysql 时区配置：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%time_zone%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+--------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+--------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" system_time_zone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CST    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" time_zone        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SYSTEM "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+--------+")]),s._v("\n")])])]),a("p",[a("strong",[s._v("解决方案")])]),s._v(" "),a("p",[s._v("方案一")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" time_zone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'+08:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" time_zone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'+08:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("方案二")]),s._v(" "),a("p",[s._v("修改 "),a("code",[s._v("my.cnf")]),s._v(" 文件，在 "),a("code",[s._v("[mysqld]")]),s._v(" 节下增加 "),a("code",[s._v("default-time-zone='+08:00'")]),s._v(" ，然后重启。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-数据表损坏如何修复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-数据表损坏如何修复"}},[s._v("#")]),s._v(" 4.3. 数据表损坏如何修复")]),s._v(" "),a("p",[s._v("使用 myisamchk 来修复，具体步骤：")]),s._v(" "),a("ol",[a("li",[s._v("修复前将 mysql 服务停止。")]),s._v(" "),a("li",[s._v("打开命令行方式，然后进入到 mysql 的 "),a("code",[s._v("bin")]),s._v(" 目录。")]),s._v(" "),a("li",[s._v("执行 myisamchk –recover 数据库所在路 /*.MYI")])]),s._v(" "),a("p",[s._v("使用 repair table 或者 OPTIMIZE table 命令来修复，REPAIR TABLE table_name 修复表 OPTIMIZE TABLE table_name 优化表 REPAIR TABLE 用于修复被破坏的表。 OPTIMIZE TABLE 用于回收闲置的数据库空间，当表上的数据行被删除时，所占据的磁盘空间并没有立即被回收，使用了 OPTIMIZE TABLE 命令后这些空间将被回收，并且对磁盘上的数据行进行重排（注意：是磁盘上，而非数据库）")]),s._v(" "),a("h3",{attrs:{id:"_4-4-数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-数据结构"}},[s._v("#")]),s._v(" 4.4. 数据结构")]),s._v(" "),a("blockquote",[a("p",[s._v("问题现象：ERROR 1071: Specified key was too long; max key length is 767 bytes")])]),s._v(" "),a("p",[s._v("问题原因：Mysql 默认情况下单个列的索引不能超过 767 位（不同版本可能存在差异） 。")]),s._v(" "),a("p",[s._v("解决方法：优化索引结构，索引字段不宜过长。")]),s._v(" "),a("h2",{attrs:{id:"_5-脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-脚本"}},[s._v("#")]),s._v(" 5. 脚本")]),s._v(" "),a("p",[s._v("这里推荐我写的几个一键运维脚本，非常方便，欢迎使用：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/dunwu/linux-tutorial/tree/master/codes/linux/soft/mysql-install.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mysql 安装脚本"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/dunwu/linux-tutorial/tree/master/codes/linux/soft/mysql-backup.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mysql 备份脚本"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"_6-参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-参考资料"}},[s._v("#")]),s._v(" 6. 参考资料")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://book.douban.com/subject/23008813/",target:"_blank",rel:"noopener noreferrer"}},[s._v("《高性能 MySQL》"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("https://www.cnblogs.com/xiaopotian/p/8196464.html")]),s._v(" "),a("li",[s._v("https://www.cnblogs.com/bigbrotherer/p/7241845.html")]),s._v(" "),a("li",[s._v("https://blog.csdn.net/managementandjava/article/details/80039650")]),s._v(" "),a("li",[s._v("http://www.manongjc.com/article/6996.html")]),s._v(" "),a("li",[s._v("https://www.cnblogs.com/xyabk/p/8967990.html")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/zyhlwzy/article/details/80569422",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 8.0 主从（Master-Slave）配置"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.im/post/58eb5d162f301e00624f014a",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mysql 主从同步实战"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.im/entry/5a0aa2026fb9a045132a369f",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 备份和恢复机制"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);