<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql 运维 | DB-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/db-tutorial/img/favicon.ico">
    <meta name="description" content="☕ db-tutorial 是一个数据库教程。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/db-tutorial/assets/css/0.styles.5dc2cb3f.css" as="style"><link rel="preload" href="/db-tutorial/assets/js/app.1598b197.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/2.cc645ea8.js" as="script"><link rel="preload" href="/db-tutorial/assets/js/22.08afd969.js" as="script"><link rel="prefetch" href="/db-tutorial/assets/js/10.67ceec29.js"><link rel="prefetch" href="/db-tutorial/assets/js/11.917853ce.js"><link rel="prefetch" href="/db-tutorial/assets/js/12.3c8f3021.js"><link rel="prefetch" href="/db-tutorial/assets/js/13.4aa0bc50.js"><link rel="prefetch" href="/db-tutorial/assets/js/14.8a375258.js"><link rel="prefetch" href="/db-tutorial/assets/js/15.edbef757.js"><link rel="prefetch" href="/db-tutorial/assets/js/16.fa4cea11.js"><link rel="prefetch" href="/db-tutorial/assets/js/17.b27d12d2.js"><link rel="prefetch" href="/db-tutorial/assets/js/18.8dbef247.js"><link rel="prefetch" href="/db-tutorial/assets/js/19.16d06c34.js"><link rel="prefetch" href="/db-tutorial/assets/js/20.349782f5.js"><link rel="prefetch" href="/db-tutorial/assets/js/21.0c4cb722.js"><link rel="prefetch" href="/db-tutorial/assets/js/23.f6078302.js"><link rel="prefetch" href="/db-tutorial/assets/js/24.2c37bceb.js"><link rel="prefetch" href="/db-tutorial/assets/js/25.612350a3.js"><link rel="prefetch" href="/db-tutorial/assets/js/26.2ce86b41.js"><link rel="prefetch" href="/db-tutorial/assets/js/27.a0af278e.js"><link rel="prefetch" href="/db-tutorial/assets/js/28.e76641c1.js"><link rel="prefetch" href="/db-tutorial/assets/js/29.16bcbce6.js"><link rel="prefetch" href="/db-tutorial/assets/js/3.07f08211.js"><link rel="prefetch" href="/db-tutorial/assets/js/30.5afae00a.js"><link rel="prefetch" href="/db-tutorial/assets/js/31.ff50dd9e.js"><link rel="prefetch" href="/db-tutorial/assets/js/32.736e210d.js"><link rel="prefetch" href="/db-tutorial/assets/js/33.024aa2b1.js"><link rel="prefetch" href="/db-tutorial/assets/js/34.347dc5ce.js"><link rel="prefetch" href="/db-tutorial/assets/js/35.4ed56603.js"><link rel="prefetch" href="/db-tutorial/assets/js/36.b279277d.js"><link rel="prefetch" href="/db-tutorial/assets/js/37.13f1b7b5.js"><link rel="prefetch" href="/db-tutorial/assets/js/38.61897c23.js"><link rel="prefetch" href="/db-tutorial/assets/js/39.2852a032.js"><link rel="prefetch" href="/db-tutorial/assets/js/4.9edd854b.js"><link rel="prefetch" href="/db-tutorial/assets/js/40.aea83b8f.js"><link rel="prefetch" href="/db-tutorial/assets/js/41.74c5f6d3.js"><link rel="prefetch" href="/db-tutorial/assets/js/42.4fb8ac6e.js"><link rel="prefetch" href="/db-tutorial/assets/js/43.78dbfcb5.js"><link rel="prefetch" href="/db-tutorial/assets/js/44.2883f73e.js"><link rel="prefetch" href="/db-tutorial/assets/js/45.c764f565.js"><link rel="prefetch" href="/db-tutorial/assets/js/46.627a475d.js"><link rel="prefetch" href="/db-tutorial/assets/js/47.8017a53d.js"><link rel="prefetch" href="/db-tutorial/assets/js/48.9e2f9da9.js"><link rel="prefetch" href="/db-tutorial/assets/js/49.9c5fec27.js"><link rel="prefetch" href="/db-tutorial/assets/js/5.3850a653.js"><link rel="prefetch" href="/db-tutorial/assets/js/50.dc175bf2.js"><link rel="prefetch" href="/db-tutorial/assets/js/51.98a34fca.js"><link rel="prefetch" href="/db-tutorial/assets/js/52.f06a8d1c.js"><link rel="prefetch" href="/db-tutorial/assets/js/53.b3848a77.js"><link rel="prefetch" href="/db-tutorial/assets/js/54.fe0c9cd5.js"><link rel="prefetch" href="/db-tutorial/assets/js/55.1116689c.js"><link rel="prefetch" href="/db-tutorial/assets/js/56.77e96777.js"><link rel="prefetch" href="/db-tutorial/assets/js/57.261e7cab.js"><link rel="prefetch" href="/db-tutorial/assets/js/58.0aa67c7c.js"><link rel="prefetch" href="/db-tutorial/assets/js/59.7712af8f.js"><link rel="prefetch" href="/db-tutorial/assets/js/6.ec598f68.js"><link rel="prefetch" href="/db-tutorial/assets/js/60.b1e26e7c.js"><link rel="prefetch" href="/db-tutorial/assets/js/61.8eec515e.js"><link rel="prefetch" href="/db-tutorial/assets/js/62.95c5ace4.js"><link rel="prefetch" href="/db-tutorial/assets/js/63.947996fd.js"><link rel="prefetch" href="/db-tutorial/assets/js/64.78f59f12.js"><link rel="prefetch" href="/db-tutorial/assets/js/65.61319496.js"><link rel="prefetch" href="/db-tutorial/assets/js/66.f5a6ec28.js"><link rel="prefetch" href="/db-tutorial/assets/js/67.f951881a.js"><link rel="prefetch" href="/db-tutorial/assets/js/68.737c984b.js"><link rel="prefetch" href="/db-tutorial/assets/js/69.a3149896.js"><link rel="prefetch" href="/db-tutorial/assets/js/7.c455f857.js"><link rel="prefetch" href="/db-tutorial/assets/js/70.4e169493.js"><link rel="prefetch" href="/db-tutorial/assets/js/71.39d3a931.js"><link rel="prefetch" href="/db-tutorial/assets/js/72.7353c48a.js"><link rel="prefetch" href="/db-tutorial/assets/js/73.f05c8db8.js"><link rel="prefetch" href="/db-tutorial/assets/js/74.900c3e27.js"><link rel="prefetch" href="/db-tutorial/assets/js/75.9af5cc6e.js"><link rel="prefetch" href="/db-tutorial/assets/js/76.e5498672.js"><link rel="prefetch" href="/db-tutorial/assets/js/77.97d6e3e6.js"><link rel="prefetch" href="/db-tutorial/assets/js/78.12c069f8.js"><link rel="prefetch" href="/db-tutorial/assets/js/79.5c8ca0d8.js"><link rel="prefetch" href="/db-tutorial/assets/js/8.acea45c9.js"><link rel="prefetch" href="/db-tutorial/assets/js/80.1ba70bec.js"><link rel="prefetch" href="/db-tutorial/assets/js/81.8d6502ea.js"><link rel="prefetch" href="/db-tutorial/assets/js/82.040529c2.js"><link rel="prefetch" href="/db-tutorial/assets/js/83.4ccae056.js"><link rel="prefetch" href="/db-tutorial/assets/js/84.c8813d8a.js"><link rel="prefetch" href="/db-tutorial/assets/js/85.947070c9.js"><link rel="prefetch" href="/db-tutorial/assets/js/9.0ef39ce9.js">
    <link rel="stylesheet" href="/db-tutorial/assets/css/0.styles.5dc2cb3f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo.png" alt="DB-TUTORIAL" class="logo"> <span class="site-name can-hide">DB-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/db-tutorial/12.数据库/01.数据库综合/" class="nav-link">数据库综合</a></div><div class="nav-item"><a href="/db-tutorial/12.数据库/02.数据库中间件/" class="nav-link">数据库中间件</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关系型数据库" class="dropdown-title"><a href="/db-tutorial/12.数据库/03.关系型数据库/" class="link-title">关系型数据库</a> <span class="title" style="display:none;">关系型数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/03.关系型数据库/01.综合/" class="nav-link">综合</a></li><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/03.关系型数据库/02.Mysql/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/03.关系型数据库/99.其他/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档数据库" class="dropdown-title"><!----> <span class="title" style="display:;">文档数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/04.文档数据库/01.MongoDB/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="KV数据库" class="dropdown-title"><!----> <span class="title" style="display:;">KV数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/05.KV数据库/01.Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搜索引擎数据库" class="dropdown-title"><!----> <span class="title" style="display:;">搜索引擎数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/07.搜索引擎数据库/01.Elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/07.搜索引擎数据库/02.Elastic/" class="nav-link">Elastic技术栈</a></li></ul></div></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/db-tutorial/12.数据库/01.数据库综合/" class="nav-link">数据库综合</a></div><div class="nav-item"><a href="/db-tutorial/12.数据库/02.数据库中间件/" class="nav-link">数据库中间件</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关系型数据库" class="dropdown-title"><a href="/db-tutorial/12.数据库/03.关系型数据库/" class="link-title">关系型数据库</a> <span class="title" style="display:none;">关系型数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/03.关系型数据库/01.综合/" class="nav-link">综合</a></li><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/03.关系型数据库/02.Mysql/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/03.关系型数据库/99.其他/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档数据库" class="dropdown-title"><!----> <span class="title" style="display:;">文档数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/04.文档数据库/01.MongoDB/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="KV数据库" class="dropdown-title"><!----> <span class="title" style="display:;">KV数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/05.KV数据库/01.Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搜索引擎数据库" class="dropdown-title"><!----> <span class="title" style="display:;">搜索引擎数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/07.搜索引擎数据库/01.Elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/db-tutorial/12.数据库/07.搜索引擎数据库/02.Elastic/" class="nav-link">Elastic技术栈</a></li></ul></div></div> <a href="https://github.com/dunwu/db-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库综合</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/0e1012/" class="sidebar-link">Nosql技术选型</a></li><li><a href="/db-tutorial/pages/d7cd88/" class="sidebar-link">数据结构与数据库索引</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库中间件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Shardingsphere</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/5ed2a2/" class="sidebar-link">ShardingSphere 简介</a></li><li><a href="/db-tutorial/pages/8448de/" class="sidebar-link">ShardingSphere Jdbc</a></li></ul></section></li><li><a href="/db-tutorial/pages/e2648c/" class="sidebar-link">版本管理中间件 Flyway</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>关系型数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>综合</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/9bb28f/" class="sidebar-link">关系型数据库面试</a></li><li><a href="/db-tutorial/pages/b71c9e/" class="sidebar-link">sql-cheat-sheet</a></li><li><a href="/db-tutorial/pages/55e9a7/" class="sidebar-link">扩展 SQL</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Mysql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/5fe0f3/" class="sidebar-link">Mysql 应用指南</a></li><li><a href="/db-tutorial/pages/8262aa/" class="sidebar-link">MySQL 工作流</a></li><li><a href="/db-tutorial/pages/00b04d/" class="sidebar-link">Mysql 事务</a></li><li><a href="/db-tutorial/pages/f1f151/" class="sidebar-link">Mysql 锁</a></li><li><a href="/db-tutorial/pages/fcb19c/" class="sidebar-link">Mysql 索引</a></li><li><a href="/db-tutorial/pages/396816/" class="sidebar-link">Mysql 性能优化</a></li><li><a href="/db-tutorial/pages/e33b92/" aria-current="page" class="active sidebar-link">Mysql 运维</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/db-tutorial/pages/e33b92/#_1-安装部署" class="sidebar-link">1. 安装部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_1-1-windows-安装" class="sidebar-link">1.1. Windows 安装</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_1-2-centos-安装" class="sidebar-link">1.2. CentOS 安装</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#安装-mysql-yum-源" class="sidebar-link">安装 mysql yum 源</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#mysql-服务管理" class="sidebar-link">mysql 服务管理</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_1-3-初始化数据库密码" class="sidebar-link">1.3. 初始化数据库密码</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_1-4-配置远程访问" class="sidebar-link">1.4. 配置远程访问</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_1-5-跳过登录认证" class="sidebar-link">1.5. 跳过登录认证</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/db-tutorial/pages/e33b92/#_2-基本运维" class="sidebar-link">2. 基本运维</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-1-客户端连接" class="sidebar-link">2.1. 客户端连接</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-2-查看连接" class="sidebar-link">2.2. 查看连接</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-3-创建用户" class="sidebar-link">2.3. 创建用户</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-4-查看用户" class="sidebar-link">2.4. 查看用户</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-5-授权" class="sidebar-link">2.5. 授权</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-6-撤销授权" class="sidebar-link">2.6. 撤销授权</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-7-查看授权" class="sidebar-link">2.7. 查看授权</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-8-更改用户密码" class="sidebar-link">2.8. 更改用户密码</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-9-备份与恢复" class="sidebar-link">2.9. 备份与恢复</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#备份一个数据库" class="sidebar-link">备份一个数据库</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#备份多个数据库" class="sidebar-link">备份多个数据库</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#备份所有数据库" class="sidebar-link">备份所有数据库</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#恢复一个数据库" class="sidebar-link">恢复一个数据库</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#恢复所有数据库" class="sidebar-link">恢复所有数据库</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-10-卸载" class="sidebar-link">2.10. 卸载</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_2-11-主从节点部署" class="sidebar-link">2.11. 主从节点部署</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#主节点上的操作" class="sidebar-link">主节点上的操作</a></li><li class="sidebar-sub-header level4"><a href="/db-tutorial/pages/e33b92/#从节点上的操作" class="sidebar-link">从节点上的操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/db-tutorial/pages/e33b92/#_3-服务器配置" class="sidebar-link">3. 服务器配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_3-1-配置文件路径" class="sidebar-link">3.1. 配置文件路径</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_3-2-配置项语法" class="sidebar-link">3.2. 配置项语法</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_3-3-常用配置项说明" class="sidebar-link">3.3. 常用配置项说明</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/db-tutorial/pages/e33b92/#_4-常见问题" class="sidebar-link">4. 常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_4-1-too-many-connections" class="sidebar-link">4.1. Too many connections</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_4-2-时区-time-zone-偏差" class="sidebar-link">4.2. 时区（time_zone）偏差</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_4-3-数据表损坏如何修复" class="sidebar-link">4.3. 数据表损坏如何修复</a></li><li class="sidebar-sub-header level3"><a href="/db-tutorial/pages/e33b92/#_4-4-数据结构" class="sidebar-link">4.4. 数据结构</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/db-tutorial/pages/e33b92/#_5-脚本" class="sidebar-link">5. 脚本</a></li><li class="sidebar-sub-header level2"><a href="/db-tutorial/pages/e33b92/#_6-参考资料" class="sidebar-link">6. 参考资料</a></li></ul></li><li><a href="/db-tutorial/pages/5da42d/" class="sidebar-link">Mysql 配置</a></li><li><a href="/db-tutorial/pages/7b0caf/" class="sidebar-link">Mysql 常见问题</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/52609d/" class="sidebar-link">PostgreSQL 应用指南</a></li><li><a href="/db-tutorial/pages/f27c0c/" class="sidebar-link">H2 应用指南</a></li><li><a href="/db-tutorial/pages/bdcd7e/" class="sidebar-link">sqlite</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>文档数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>MongoDB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/3288f3/" class="sidebar-link">MongoDB 应用指南</a></li><li><a href="/db-tutorial/pages/7efbac/" class="sidebar-link">MongoDB 的 CRUD 操作</a></li><li><a href="/db-tutorial/pages/75daa5/" class="sidebar-link">MongoDB 的聚合操作</a></li><li><a href="/db-tutorial/pages/4574fe/" class="sidebar-link">MongoDB 事务</a></li><li><a href="/db-tutorial/pages/562f99/" class="sidebar-link">MongoDB 建模</a></li><li><a href="/db-tutorial/pages/88c7d3/" class="sidebar-link">MongoDB 建模示例</a></li><li><a href="/db-tutorial/pages/10c674/" class="sidebar-link">MongoDB 索引</a></li><li><a href="/db-tutorial/pages/505407/" class="sidebar-link">MongoDB 复制</a></li><li><a href="/db-tutorial/pages/ad08f5/" class="sidebar-link">MongoDB 分片</a></li><li><a href="/db-tutorial/pages/5e3c30/" class="sidebar-link">MongoDB 运维</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>KV数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/451b73/" class="sidebar-link">Redis 面试总结</a></li><li><a href="/db-tutorial/pages/94e9d6/" class="sidebar-link">Redis 应用指南</a></li><li><a href="/db-tutorial/pages/ed757c/" class="sidebar-link">Redis 数据类型和应用</a></li><li><a href="/db-tutorial/pages/4de901/" class="sidebar-link">Redis 持久化</a></li><li><a href="/db-tutorial/pages/379cd8/" class="sidebar-link">Redis 复制</a></li><li><a href="/db-tutorial/pages/615afe/" class="sidebar-link">Redis 哨兵</a></li><li><a href="/db-tutorial/pages/77dfbe/" class="sidebar-link">Redis 集群</a></li><li><a href="/db-tutorial/pages/1fc9c4/" class="sidebar-link">Redis 实战</a></li><li><a href="/db-tutorial/pages/537098/" class="sidebar-link">Redis 运维</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>列式数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/7ab03c/" class="sidebar-link">Hbase</a></li><li><a href="/db-tutorial/pages/ca3ca5/" class="sidebar-link">Cassandra</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>搜索引擎数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/0cb563/" class="sidebar-link">Elasticsearch 面试总结</a></li><li><a href="/db-tutorial/pages/98c3a5/" class="sidebar-link">Elasticsearch 快速入门</a></li><li><a href="/db-tutorial/pages/0fb506/" class="sidebar-link">Elasticsearch 简介</a></li><li><a href="/db-tutorial/pages/293175/" class="sidebar-link">Elasticsearch 索引</a></li><li><a href="/db-tutorial/pages/83bd15/" class="sidebar-link">Elasticsearch 查询</a></li><li><a href="/db-tutorial/pages/e1b769/" class="sidebar-link">Elasticsearch 高亮搜索及显示</a></li><li><a href="/db-tutorial/pages/24baff/" class="sidebar-link">Elasticsearch 排序</a></li><li><a href="/db-tutorial/pages/f89f66/" class="sidebar-link">Elasticsearch 聚合</a></li><li><a href="/db-tutorial/pages/a5a001/" class="sidebar-link">Elasticsearch 分析器</a></li><li><a href="/db-tutorial/pages/2d95ce/" class="sidebar-link">Elasticsearch 性能优化</a></li><li><a href="/db-tutorial/pages/4b1907/" class="sidebar-link">Elasticsearch Rest API</a></li><li><a href="/db-tutorial/pages/201e43/" class="sidebar-link">ElasticSearch Java API 之 High Level REST Client</a></li><li><a href="/db-tutorial/pages/9a2546/" class="sidebar-link">Elasticsearch 集群和分片</a></li><li><a href="/db-tutorial/pages/fdaf15/" class="sidebar-link">Elasticsearch 运维</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Elastic</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/db-tutorial/pages/553160/" class="sidebar-link">Elastic 快速入门</a></li><li><a href="/db-tutorial/pages/b7f079/" class="sidebar-link">Elastic 技术栈之 Filebeat</a></li><li><a href="/db-tutorial/pages/7c067f/" class="sidebar-link">Filebeat 运维</a></li><li><a href="/db-tutorial/pages/002159/" class="sidebar-link">Elastic 技术栈之 Kibana</a></li><li><a href="/db-tutorial/pages/fc47af/" class="sidebar-link">Kibana 运维</a></li><li><a href="/db-tutorial/pages/55ce99/" class="sidebar-link">Elastic 技术栈之 Logstash</a></li><li><a href="/db-tutorial/pages/92df30/" class="sidebar-link">Logstash 运维</a></li></ul></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/db-tutorial/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/db-tutorial/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>数据库</a></li><li data-v-06225672><a href="/db-tutorial/categories/?category=%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>关系型数据库</a></li><li data-v-06225672><a href="/db-tutorial/categories/?category=Mysql" title="分类" data-v-06225672>Mysql</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/dunwu" target="_blank" title="作者" class="beLink" data-v-06225672>dunwu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2019-11-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Mysql 运维<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="mysql-运维"><a href="#mysql-运维" class="header-anchor">#</a> Mysql 运维</h1> <blockquote><p>如果你的公司有 DBA，那么我恭喜你，你可以无视 Mysql 运维。如果你的公司没有 DBA，那你就好好学两手 Mysql 基本运维操作，行走江湖，防身必备。</p></blockquote> <h2 id="_1-安装部署"><a href="#_1-安装部署" class="header-anchor">#</a> 1. 安装部署</h2> <h3 id="_1-1-windows-安装"><a href="#_1-1-windows-安装" class="header-anchor">#</a> 1.1. Windows 安装</h3> <p>（1）下载 Mysql 5.7 免安装版</p> <p>下载地址：https://dev.mysql.com/downloads/mysql/5.7.html#downloads</p> <p>（2）解压并创建 my.ini 在根目录</p> <p>my.ini 文件示例：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token comment">#设置3306端口</span>
<span class="token key attr-name">port</span> <span class="token punctuation">=</span> <span class="token value attr-value">3306</span>
<span class="token comment"># 设置mysql的安装目录 这块换成自己解压的路径</span>
<span class="token key attr-name">basedir</span><span class="token punctuation">=</span><span class="token value attr-value">D:\\Tools\\DB\\mysql\\mysql-5.7.31</span>
<span class="token comment"># 允许最大连接数</span>
<span class="token key attr-name">max_connections</span><span class="token punctuation">=</span><span class="token value attr-value">200</span>
<span class="token comment"># 服务端使用的字符集默认为8比特编码的latin1字符集</span>
<span class="token key attr-name">character-set-server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span>
<span class="token comment"># 创建新表时将使用的默认存储引擎</span>
<span class="token key attr-name">default-storage-engine</span><span class="token punctuation">=</span><span class="token value attr-value">INNODB</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">client</span><span class="token punctuation">]</span></span>
<span class="token comment"># 设置mysql客户端默认字符集</span>
<span class="token key attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span>
</code></pre></div><p>（3）执行安装命令</p> <p>在控制台 CMD 中依次执行以下安装命令</p> <div class="language- extra-class"><pre class="language-text"><code>cd D:\\Tools\\DB\\mysql\\mysql-5.7.31
mysqld --initialize
mysqld -install
</code></pre></div><p>说明：</p> <ul><li><code>mysqld --initialize</code> 会自动初始化创建 data 文件夹并初始化 mysql。</li> <li><code>mysqld -install</code> 会安装 mysql 服务。</li></ul> <p>（4）启动服务</p> <p>在控制台执行 <code>net start mysql</code> 启动服务。</p> <h3 id="_1-2-centos-安装"><a href="#_1-2-centos-安装" class="header-anchor">#</a> 1.2. CentOS 安装</h3> <blockquote><p>本文仅介绍 rpm 安装方式</p></blockquote> <h4 id="安装-mysql-yum-源"><a href="#安装-mysql-yum-源" class="header-anchor">#</a> 安装 mysql yum 源</h4> <p>官方下载地址：https://dev.mysql.com/downloads/repo/yum/</p> <p>（1）下载 yum 源</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm
</code></pre></div><p>（2）安装 yum repo 文件并更新 yum 缓存</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql80-community-release-el7-1.noarch.rpm
</code></pre></div><p>执行结果：</p> <p>会在 /etc/yum.repos.d/ 目录下生成两个 repo 文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> mysql
mysql-community.repo
mysql-community-source.repo
</code></pre></div><p>更新 yum：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum clean all
yum makecache
</code></pre></div><p>（3）查看 rpm 安装状态</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ yum search mysql <span class="token operator">|</span> <span class="token function">grep</span> server
mysql-community-common.i686 <span class="token builtin class-name">:</span> MySQL database common files <span class="token keyword">for</span> server and client
mysql-community-common.x86_64 <span class="token builtin class-name">:</span> MySQL database common files <span class="token keyword">for</span> server and
mysql-community-test.x86_64 <span class="token builtin class-name">:</span> Test suite <span class="token keyword">for</span> the MySQL database server
                       <span class="token builtin class-name">:</span> administering MySQL servers
mysql-community-server.x86_64 <span class="token builtin class-name">:</span> A very fast and reliable SQL database server
</code></pre></div><p>通过 yum 安装 mysql 有几个重要目录：</p> <div class="language- extra-class"><pre class="language-text"><code>## 配置文件
/etc/my.cnf
## 数据库目录
/var/lib/mysql/
## 配置文件
/usr/share/mysql（mysql.server命令及配置文件）
## 相关命令
/usr/bin（mysqladmin mysqldump等命令）
## 启动脚本
/usr/lib/systemd/system/mysqld.service （注册为 systemd 服务）
</code></pre></div><p>（4）安装 mysql 服务器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> mysql-community-server
</code></pre></div><h4 id="mysql-服务管理"><a href="#mysql-服务管理" class="header-anchor">#</a> mysql 服务管理</h4> <p>通过 yum 方式安装 mysql 后，本地会有一个名为 <code>mysqld</code> 的 systemd 服务。</p> <p>其服务管理十分简便：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 查看状态</span>
systemctl status mysqld
<span class="token comment">## 启用服务</span>
systemctl <span class="token builtin class-name">enable</span> mysqld
<span class="token comment">## 禁用服务</span>
systemctl disable mysqld
<span class="token comment">## 启动服务</span>
systemctl start mysqld
<span class="token comment">## 重启服务</span>
systemctl restart mysqld
<span class="token comment">## 停止服务</span>
systemctl stop mysqld
</code></pre></div><h3 id="_1-3-初始化数据库密码"><a href="#_1-3-初始化数据库密码" class="header-anchor">#</a> 1.3. 初始化数据库密码</h3> <p>查看一下初始密码</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">grep</span> <span class="token string">&quot;password&quot;</span> /var/log/mysqld.log
<span class="token number">2018</span>-09-30T03:13:41.727736Z <span class="token number">5</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> <span class="token punctuation">[</span>MY-010454<span class="token punctuation">]</span> <span class="token punctuation">[</span>Server<span class="token punctuation">]</span> A temporary password is generated <span class="token keyword">for</span> root@localhost: %:lt+srWu4k1
</code></pre></div><p>执行命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql <span class="token parameter variable">-uroot</span> -p<span class="token operator">&lt;</span>临时密码<span class="token operator">&gt;</span>
</code></pre></div><p>输入临时密码，进入 mysql，如果要修改密码，执行以下指令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ALTER user <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'你的密码'</span><span class="token punctuation">;</span>
</code></pre></div><p>注：密码强度默认为中等，大小写字母、数字、特殊符号，只有修改成功后才能修改配置再设置更简单的密码</p> <h3 id="_1-4-配置远程访问"><a href="#_1-4-配置远程访问" class="header-anchor">#</a> 1.4. 配置远程访问</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'你的密码'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'root'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'你的密码'</span><span class="token punctuation">;</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-5-跳过登录认证"><a href="#_1-5-跳过登录认证" class="header-anchor">#</a> 1.5. 跳过登录认证</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">vim</span> /etc/my.cnf
</code></pre></div><p>在 [mysqld] 下面加上 skip-grant-tables</p> <p>作用是登录时跳过登录认证，换句话说就是 root 什么密码都可以登录进去。</p> <p>执行 <code>systemctl restart mysqld</code>，重启 mysql</p> <h2 id="_2-基本运维"><a href="#_2-基本运维" class="header-anchor">#</a> 2. 基本运维</h2> <h3 id="_2-1-客户端连接"><a href="#_2-1-客户端连接" class="header-anchor">#</a> 2.1. 客户端连接</h3> <p>语法：<code>mysql -h&lt;主机&gt; -P&lt;端口&gt; -u&lt;用户名&gt; -p&lt;密码&gt;</code></p> <p>如果没有显式指定密码，会要求输入密码才能访问。</p> <p>【示例】连接本地 Mysql</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ mysql <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-P</span> <span class="token number">3306</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
Enter password:
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">13501</span>
Server version: <span class="token number">8.0</span>.19 MySQL Community Server - GPL

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2020</span>, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span>
</code></pre></div><h3 id="_2-2-查看连接"><a href="#_2-2-查看连接" class="header-anchor">#</a> 2.2. 查看连接</h3> <p>连接完成后，如果你没有后续的动作，这个连接就处于空闲状态，你可以在 <code>show processlist</code> 命令中看到它。客户端如果太长时间没动静，连接器就会自动将它断开。这个时间是由参数 <code>wait_timeout</code> 控制的，默认值是 8 小时。</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200714115031.png" alt="img"></p> <h3 id="_2-3-创建用户"><a href="#_2-3-创建用户" class="header-anchor">#</a> 2.3. 创建用户</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'username'</span><span class="token variable">@'host'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'password'</span><span class="token punctuation">;</span>
</code></pre></div><p>说明：</p> <ul><li>username：你将创建的用户名</li> <li>host：指定该用户在哪个主机上可以登陆，如果是本地用户可用 localhost，如果想让该用户可以<strong>从任意远程主机登陆</strong>，可以使用通配符<code>%</code></li> <li>password：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器</li></ul> <p>示例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'dog'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'pig'</span><span class="token variable">@'192.168.1.101_'</span> IDENDIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：在 Mysql 8 中，默认密码验证不再是 <code>password</code>。所以在创建用户时，<code>create user 'username'@'%' identified by 'password';</code> 客户端是无法连接服务的。</p> <p>所以，需要加上 <code>IDENTIFIED WITH mysql_native_password</code>，例如：<code>CREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY '123456';</code></p></blockquote> <h3 id="_2-4-查看用户"><a href="#_2-4-查看用户" class="header-anchor">#</a> 2.4. 查看用户</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查看所有用户</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'User: '''</span><span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">,</span> <span class="token string">'''@'''</span><span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token string">''';'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> query
<span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-5-授权"><a href="#_2-5-授权" class="header-anchor">#</a> 2.5. 授权</h3> <p>命令：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">privileges</span> <span class="token keyword">ON</span> databasename<span class="token punctuation">.</span>tablename <span class="token keyword">TO</span> <span class="token string">'username'</span><span class="token variable">@'host'</span>
</code></pre></div><p>说明：</p> <ul><li>privileges：用户的操作权限，如<code>SELECT</code>，<code>INSERT</code>，<code>UPDATE</code>等，如果要授予所的权限则使用<code>ALL</code></li> <li>databasename：数据库名</li> <li>tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用<code>*</code>表示，如<code>*.*</code></li></ul> <p>示例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> test<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">TO</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> maindataplus<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：</p> <p>用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 为指定用户配置指定权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">privileges</span> <span class="token keyword">ON</span> databasename<span class="token punctuation">.</span>tablename <span class="token keyword">TO</span> <span class="token string">'username'</span><span class="token variable">@'host'</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span>
<span class="token comment">-- 为 root 用户分配所有权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'密码'</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-6-撤销授权"><a href="#_2-6-撤销授权" class="header-anchor">#</a> 2.6. 撤销授权</h3> <p>命令:</p> <div class="language- extra-class"><pre class="language-text"><code>REVOKE privilege ON databasename.tablename FROM 'username'@'host';
</code></pre></div><p>说明:</p> <p>privilege, databasename, tablename：同授权部分</p> <p>例子:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre></div><p>注意:</p> <p>假如你在给用户<code>'pig'@'%'</code>授权的时候是这样的（或类似的）：<code>GRANT SELECT ON test.user TO 'pig'@'%'</code>，则在使用<code>REVOKE SELECT ON *.* FROM 'pig'@'%';</code>命令并不能撤销该用户对 test 数据库中 user 表的<code>SELECT</code> 操作。相反，如果授权使用的是<code>GRANT SELECT ON *.* TO 'pig'@'%';</code>则<code>REVOKE SELECT ON test.user FROM 'pig'@'%';</code>命令也不能撤销该用户对 test 数据库中 user 表的<code>Select</code>权限。</p> <p>具体信息可以用命令<code>SHOW GRANTS FOR 'pig'@'%';</code> 查看。</p> <h3 id="_2-7-查看授权"><a href="#_2-7-查看授权" class="header-anchor">#</a> 2.7. 查看授权</h3> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token comment">-- 查看用户权限</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'root'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-8-更改用户密码"><a href="#_2-8-更改用户密码" class="header-anchor">#</a> 2.8. 更改用户密码</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">'username'</span><span class="token variable">@'host'</span> <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'newpassword'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果是当前登陆用户用:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">&quot;newpassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">'pig'</span><span class="token variable">@'%'</span> <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-9-备份与恢复"><a href="#_2-9-备份与恢复" class="header-anchor">#</a> 2.9. 备份与恢复</h3> <p>Mysql 备份数据使用 mysqldump 命令。</p> <p>mysqldump 将数据库中的数据备份成一个文本文件，表的结构和表中的数据将存储在生成的文本文件中。</p> <p>备份：</p> <h4 id="备份一个数据库"><a href="#备份一个数据库" class="header-anchor">#</a> 备份一个数据库</h4> <p>语法：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqldump <span class="token operator">-</span>h <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token operator">-</span>P<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token operator">-</span>u<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">-</span>p<span class="token operator">&lt;</span><span class="token keyword">database</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>table1<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>table2<span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token keyword">backup</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre></div><ul><li><strong><code>host</code></strong> - Mysql Server 的 host</li> <li><strong><code>port</code></strong> - Mysql Server 的端口</li> <li><strong><code>username</code></strong> - 数据库用户</li> <li><strong><code>dbname</code></strong> - 数据库名称</li> <li>table1 和 table2 参数表示需要备份的表的名称，为空则整个数据库备份；</li> <li>BackupName.sql 参数表设计备份文件的名称，文件名前面可以加上一个绝对路径。通常将数据库被分成一个后缀名为 sql 的文件</li></ul> <h4 id="备份多个数据库"><a href="#备份多个数据库" class="header-anchor">#</a> 备份多个数据库</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqldump <span class="token operator">-</span>u <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">-</span>p <span class="token comment">--databases &lt;database1&gt; &lt;database2&gt; ... &gt; backup.sql</span>
</code></pre></div><h4 id="备份所有数据库"><a href="#备份所有数据库" class="header-anchor">#</a> 备份所有数据库</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqldump <span class="token operator">-</span>u <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">-</span>p <span class="token comment">--all-databases &gt; backup.sql</span>
</code></pre></div><h4 id="恢复一个数据库"><a href="#恢复一个数据库" class="header-anchor">#</a> 恢复一个数据库</h4> <p>Mysql 恢复数据使用 mysql 命令。</p> <p>语法：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql <span class="token operator">-</span>h <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token operator">-</span>P<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token operator">-</span>u<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">-</span>p<span class="token operator">&lt;</span><span class="token keyword">database</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span> <span class="token keyword">backup</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre></div><h4 id="恢复所有数据库"><a href="#恢复所有数据库" class="header-anchor">#</a> 恢复所有数据库</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql <span class="token operator">-</span>u<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">-</span>p <span class="token comment">--all-databases &lt; backup.sql</span>
</code></pre></div><h3 id="_2-10-卸载"><a href="#_2-10-卸载" class="header-anchor">#</a> 2.10. 卸载</h3> <p>（1）查看已安装的 mysql</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> mysql
perl-DBD-MySQL-4.023-6.el7.x86_64
mysql80-community-release-el7-1.noarch
mysql-community-common-8.0.12-1.el7.x86_64
mysql-community-client-8.0.12-1.el7.x86_64
mysql-community-libs-compat-8.0.12-1.el7.x86_64
mysql-community-libs-8.0.12-1.el7.x86_64
</code></pre></div><p>（2）卸载 mysql</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum remove mysql-community-server.x86_64
</code></pre></div><h3 id="_2-11-主从节点部署"><a href="#_2-11-主从节点部署" class="header-anchor">#</a> 2.11. 主从节点部署</h3> <p>假设需要配置一个主从 Mysql 服务器环境</p> <ul><li>master 节点：192.168.8.10</li> <li>slave 节点：192.168.8.11</li></ul> <h4 id="主节点上的操作"><a href="#主节点上的操作" class="header-anchor">#</a> 主节点上的操作</h4> <p>（1）修改配置并重启</p> <p>执行 <code>vi /etc/my.cnf</code> ，添加如下配置：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">log_bin</span><span class="token punctuation">=</span><span class="token value attr-value">/var/lib/mysql/binlog</span>
</code></pre></div><ul><li><code>server-id</code> - 服务器 ID 号。在主从架构中，每台机器的 ID 必须唯一。</li> <li><code>log_bin</code> - 同步的日志路径及文件名，一定注意这个目录要是 mysql 有权限写入的；</li></ul> <p>修改后，重启 mysql 使配置生效：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>systemctl restart mysql
</code></pre></div><p>（2）创建用于同步的用户</p> <p>进入 mysql 命令控制台：</p> <div class="language- extra-class"><pre class="language-text"><code>$ mysql -u root -p
Password:
</code></pre></div><p>执行以下 SQL：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- a. 创建 slave 用户</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'slave'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'密码'</span><span class="token punctuation">;</span>
<span class="token comment">-- 为 slave 赋予 REPLICATION SLAVE 权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'slave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>

<span class="token comment">-- b. 或者，创建 slave 用户，并指定该用户能在任意主机上登录</span>
<span class="token comment">-- 如果有多个从节点，又想让所有从节点都使用统一的用户名、密码认证，可以考虑这种方式</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'slave'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'密码'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'slave'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>

<span class="token comment">-- 刷新授权表信息</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：在 Mysql 8 中，默认密码验证不再是 <code>password</code>。所以在创建用户时，<code>create user 'username'@'%' identified by 'password';</code> 客户端是无法连接服务的。所以，需要加上 <code>IDENTIFIED WITH mysql_native_password BY 'password'</code></p></blockquote> <p>补充用户管理 SQL:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查看所有用户</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'User: '''</span><span class="token punctuation">,</span> <span class="token keyword">user</span><span class="token punctuation">,</span> <span class="token string">'''@'''</span><span class="token punctuation">,</span> host<span class="token punctuation">,</span> <span class="token string">''';'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> query
<span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token comment">-- 查看用户权限</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'root'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建用户</span>
<span class="token comment">-- a. 创建 slave 用户，并指定该用户只能在主机 192.168.8.11 上登录</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'slave'</span><span class="token variable">@'192.168.8.11'</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">'密码'</span><span class="token punctuation">;</span>
<span class="token comment">-- 为 slave 赋予 REPLICATION SLAVE 权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'slave'</span><span class="token variable">@'192.168.8.11'</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除用户</span>
<span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">'slave'</span><span class="token variable">@'192.168.8.11'</span><span class="token punctuation">;</span>
</code></pre></div><p>（3）加读锁</p> <p>为了主库与从库的数据保持一致，我们先为 mysql 加入读锁，使其变为只读。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> FLUSH <span class="token keyword">TABLES</span> <span class="token keyword">WITH</span> <span class="token keyword">READ</span> <span class="token keyword">LOCK</span><span class="token punctuation">;</span>
</code></pre></div><p>（4）查看主节点状态</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+---------------------------------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">File</span>             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB                            <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+---------------------------------------------+-------------------+</span>
<span class="token operator">|</span> mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span> <span class="token operator">|</span>     <span class="token number">4202</span> <span class="token operator">|</span>              <span class="token operator">|</span> mysql<span class="token punctuation">,</span>information_schema<span class="token punctuation">,</span>performance_schema <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+---------------------------------------------+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>注意：需要记录下 <code>File</code> 和 <code>Position</code>，后面会用到。</p></blockquote> <p>（5）导出 sql</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysqldump <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> --all-databases --master-data <span class="token operator">&gt;</span> dbdump.sql
</code></pre></div><p>（6）解除读锁</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre></div><p>（7）将 sql 远程传送到从节点上</p> <div class="language- extra-class"><pre class="language-text"><code>scp dbdump.sql root@192.168.8.11:/home
</code></pre></div><h4 id="从节点上的操作"><a href="#从节点上的操作" class="header-anchor">#</a> 从节点上的操作</h4> <p>（1）修改配置并重启</p> <p>执行 <code>vi /etc/my.cnf</code> ，添加如下配置：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
<span class="token key attr-name">log_bin</span><span class="token punctuation">=</span><span class="token value attr-value">/var/lib/mysql/binlog</span>
</code></pre></div><ul><li><code>server-id</code> - 服务器 ID 号。在主从架构中，每台机器的 ID 必须唯一。</li> <li><code>log_bin</code> - 同步的日志路径及文件名，一定注意这个目录要是 mysql 有权限写入的；</li></ul> <p>修改后，重启 mysql 使配置生效：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl restart mysql
</code></pre></div><p>（2）导入 sql</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span> /home/dbdump.sql
</code></pre></div><p>（3）在从节点上建立与主节点的连接</p> <p>进入 mysql 命令控制台：</p> <div class="language- extra-class"><pre class="language-text"><code>$ mysql -u root -p
Password:
</code></pre></div><p>执行以下 SQL：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 停止从节点服务</span>
STOP SLAVE<span class="token punctuation">;</span>

<span class="token comment">-- 注意：MASTER_USER 和</span>
CHANGE MASTER <span class="token keyword">TO</span>
MASTER_HOST<span class="token operator">=</span><span class="token string">'192.168.8.10'</span><span class="token punctuation">,</span>
MASTER_USER<span class="token operator">=</span><span class="token string">'slave'</span><span class="token punctuation">,</span>
MASTER_PASSWORD<span class="token operator">=</span><span class="token string">'密码'</span><span class="token punctuation">,</span>
MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">'binlog.000001'</span><span class="token punctuation">,</span>
MASTER_LOG_POS<span class="token operator">=</span><span class="token number">4202</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>MASTER_LOG_FILE</code> 和 <code>MASTER_LOG_POS</code> 参数要分别与 <code>show master status</code> 指令获得的 <code>File</code> 和 <code>Position</code> 属性值对应。</li> <li><code>MASTER_HOST</code> 是主节点的 HOST。</li> <li><code>MASTER_USER</code> 和 <code>MASTER_PASSWORD</code> 是在主节点上注册的用户及密码。</li></ul> <p>（4）启动 slave 进程</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre></div><p>（5）查看主从同步状态</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> slave <span class="token keyword">status</span>\G<span class="token punctuation">;</span>
</code></pre></div><p>说明：如果以下两项参数均为 YES，说明配置正确。</p> <ul><li><code>Slave_IO_Running</code></li> <li><code>Slave_SQL_Running</code></li></ul> <p>（6）将从节点设为只读</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> read_only<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> super_read_only<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">&quot;%read_only%&quot;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------+</span>
<span class="token operator">|</span> Variable_name         <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------+</span>
<span class="token operator">|</span> innodb_read_only      <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">|</span> read_only             <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span>
<span class="token operator">|</span> super_read_only       <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span>
<span class="token operator">|</span> transaction_read_only <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------+</span>
</code></pre></div><blockquote><p>注：设置 slave 服务器为只读，并不影响主从同步。</p></blockquote> <h2 id="_3-服务器配置"><a href="#_3-服务器配置" class="header-anchor">#</a> 3. 服务器配置</h2> <blockquote><p><strong><em>大部分情况下，默认的基本配置已经足够应付大多数场景，不要轻易修改 Mysql 服务器配置，除非你明确知道修改项是有益的。</em></strong></p> <p>尽量不要使用 Mysql 的缓存功能，因为其要求每次请求参数完全相同，才能命中缓存。这种方式实际上并不高效，还会增加额外开销，实际业务场景中一般使用 Redis 等 key-value 存储来解决缓存问题，性能远高于 Mysql 的查询缓存。</p></blockquote> <h3 id="_3-1-配置文件路径"><a href="#_3-1-配置文件路径" class="header-anchor">#</a> 3.1. 配置文件路径</h3> <p>配置 Mysql 首先要确定配置文件在哪儿。</p> <p>不同 Linux 操作系统上，Mysql 配置文件路径可能不同。通常的路径为 /etc/my.cnf 或 /etc/mysql/my.cnf 。</p> <p>如果不知道配置文件路径，可以尝试以下操作：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># which mysqld</span>
/usr/sbin/mysqld
<span class="token comment"># /usr/sbin/mysqld --verbose --help | grep -A 1 'Default options'</span>
Default options are <span class="token builtin class-name">read</span> from the following files <span class="token keyword">in</span> the given order:
/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf
</code></pre></div><h3 id="_3-2-配置项语法"><a href="#_3-2-配置项语法" class="header-anchor">#</a> 3.2. 配置项语法</h3> <p><strong>Mysql 配置项设置都使用小写，单词之间用下划线或横线隔开（二者是等价的）。</strong></p> <p>建议使用固定的风格，这样检索配置项时较为方便。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 这两种格式等价</span>
/usr/sbin/mysqld --auto-increment-offset<span class="token operator">=</span><span class="token number">5</span>
/usr/sbin/mysqld <span class="token parameter variable">--auto_increment_offset</span><span class="token operator">=</span><span class="token number">5</span>
</code></pre></div><h3 id="_3-3-常用配置项说明"><a href="#_3-3-常用配置项说明" class="header-anchor">#</a> 3.3. 常用配置项说明</h3> <blockquote><p>这里介绍比较常用的基本配置，更多配置项说明可以参考：<a href="/db-tutorial/12.数据库/03.关系型数据库/02.Mysql/21.Mysql配置.html">Mysql 服务器配置说明</a></p></blockquote> <p>先给出一份常用配置模板，内容如下：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token comment"># GENERAL</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token key attr-name">datadir</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/lib/mysql</span>
<span class="token key attr-name">socket</span>  <span class="token punctuation">=</span> <span class="token value attr-value">/var/lib/mysql/mysql.sock</span>
<span class="token key attr-name">pid_file</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/lib/mysql/mysql.pid</span>
<span class="token key attr-name">user</span> <span class="token punctuation">=</span> <span class="token value attr-value">mysql</span>
<span class="token key attr-name">port</span> <span class="token punctuation">=</span> <span class="token value attr-value">3306</span>
<span class="token key attr-name">default_storage_engine</span> <span class="token punctuation">=</span> <span class="token value attr-value">InnoDB</span>
<span class="token key attr-name">default_time_zone</span> <span class="token punctuation">=</span> <span class="token value attr-value">'<span class="token inner-value">+8:00</span>'</span>
<span class="token key attr-name">character_set_server</span> <span class="token punctuation">=</span> <span class="token value attr-value">utf8mb4</span>
<span class="token key attr-name">collation_server</span> <span class="token punctuation">=</span> <span class="token value attr-value">utf8mb4_0900_ai_ci</span>

<span class="token comment"># LOG</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token key attr-name">log_error</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/log/mysql/mysql-error.log</span>
<span class="token key attr-name">slow_query_log</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">slow_query_log_file</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/log/mysql/mysql-slow.log</span>

<span class="token comment"># InnoDB</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token key attr-name">innodb_buffer_pool_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">&lt;value&gt;</span>
<span class="token key attr-name">innodb_log_file_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">&lt;value&gt;</span>
<span class="token key attr-name">innodb_file_per_table</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">innodb_flush_method</span> <span class="token punctuation">=</span> <span class="token value attr-value">O_DIRECT</span>

<span class="token comment"># MyIsam</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token key attr-name">key_buffer_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">&lt;value&gt;</span>

<span class="token comment"># OTHER</span>
<span class="token comment"># -------------------------------------------------------------------------------</span>
<span class="token key attr-name">tmp_table_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">32M</span>
<span class="token key attr-name">max_heap_table_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">32M</span>
<span class="token key attr-name">query_cache_type</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token key attr-name">query_cache_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token key attr-name">max_connections</span> <span class="token punctuation">=</span> <span class="token value attr-value">&lt;value&gt;</span>
<span class="token key attr-name">thread_cache</span> <span class="token punctuation">=</span> <span class="token value attr-value">&lt;value&gt;</span>
<span class="token key attr-name">open_files_limit</span> <span class="token punctuation">=</span> <span class="token value attr-value">65535</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">client</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">socket</span>  <span class="token punctuation">=</span> <span class="token value attr-value">/var/lib/mysql/mysql.sock</span>
<span class="token key attr-name">port</span> <span class="token punctuation">=</span> <span class="token value attr-value">3306</span>
</code></pre></div><ul><li><p>GENERAL</p> <ul><li><code>datadir</code> - mysql 数据文件所在目录</li> <li><code>socket</code> - scoket 文件</li> <li><code>pid_file</code> - PID 文件</li> <li><code>user</code> - 启动 mysql 服务进程的用户</li> <li><code>port</code> - 服务端口号，默认 <code>3306</code></li> <li><code>default_storage_engine</code> - mysql 5.1 之后，默认引擎是 InnoDB</li> <li><code>default_time_zone</code> - 默认时区。中国大部分地区在东八区，即 <code>+8:00</code></li> <li><code>character_set_server</code> - 数据库默认字符集</li> <li><code>collation_server</code> - 数据库字符集对应一些排序等规则，注意要和 <code>character_set_server</code> 对应</li></ul></li> <li><p>LOG</p> <ul><li><code>log_error</code> - 错误日志文件地址</li> <li><code>slow_query_log</code> - 错误日志文件地址</li></ul></li> <li><p>InnoDB</p> <ul><li><code>innodb_buffer_pool_size</code> - InnoDB 使用一个缓冲池来保存索引和原始数据，不像 MyISAM。这里你设置越大，你在存取表里面数据时所需要的磁盘 I/O 越少。
<ul><li>在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的 60%-80%</li> <li>注意别设置的过大，会导致 system 的 swap 空间被占用，导致操作系统变慢，从而减低 sql 查询的效率</li> <li>默认值：128M，建议值：物理内存的 60%-80%</li></ul></li> <li><code>innodb_log_file_size</code> - 日志文件的大小。默认值：48M，建议值：根据你系统的磁盘空间和日志增长情况调整大小</li> <li><code>innodb_file_per_table</code> - 说明：mysql5.7 之后默认开启，意思是，每张表一个独立表空间。默认值 1，开启。</li> <li><code>innodb_flush_method</code> - 说明：控制着 innodb 数据文件及 redo log 的打开、刷写模式，三种模式：fdatasync(默认)，O_DSYNC，O_DIRECT。默认值为空，建议值：使用 SAN 或者 raid，建议用 O_DIRECT，不懂测试的话，默认生产上使用 O_DIRECT
<ul><li><code>fdatasync</code>：数据文件，buffer pool-&gt;os buffer-&gt;磁盘；日志文件，buffer pool-&gt;os buffer-&gt;磁盘；</li> <li><code>O_DSYNC</code>： 数据文件，buffer pool-&gt;os buffer-&gt;磁盘；日志文件，buffer pool-&gt;磁盘；</li> <li><code>O_DIRECT</code>： 数据文件，buffer pool-&gt;磁盘； 日志文件，buffer pool-&gt;os buffer-&gt;磁盘；</li></ul></li></ul></li> <li><p>MyIsam</p> <ul><li><code>key_buffer_size</code> - 指定索引缓冲区的大小，为 MYISAM 数据表开启供线程共享的索引缓存，对 INNODB 引擎无效。相当影响 MyISAM 的性能。
<ul><li>不要将其设置大于你可用内存的 30%，因为一部分内存同样被 OS 用来缓冲行数据</li> <li>甚至在你并不使用 MyISAM 表的情况下，你也需要仍旧设置起 8-64M 内存由于它同样会被内部临时磁盘表使用。</li> <li>默认值 8M，建议值：对于内存在 4GB 左右的服务器该参数可设置为 256M 或 384M。</li> <li>注意：该参数值设置的过大反而会是服务器整体效率降低！</li></ul></li></ul></li> <li><p>OTHER</p> <ul><li><code>tmp_table_size</code> - 内存临时表的最大值，默认 16M，此处设置成 128M</li> <li><code>max_heap_table_size</code> - 用户创建的内存表的大小，默认 16M，往往和 <code>tmp_table_size</code> 一起设置，限制用户临时表大小。超限的话，MySQL 就会自动地把它转化为基于磁盘的 MyISAM 表，存储在指定的 tmpdir 目录下，增大 IO 压力，建议内存大，增大该数值。</li> <li><code>query_cache_type</code> - 这个系统变量控制着查询缓存功能的开启和关闭，0 表示关闭，1 表示打开，2 表示只要 <code>select</code> 中明确指定 <code>SQL_CACHE</code> 才缓存。</li> <li><code>query_cache_size</code> - 默认值 1M，优点是查询缓存可以极大的提高服务器速度，如果你有大量的相同的查询并且很少修改表。缺点：在你表经常变化的情况下或者如果你的查询原文每次都不同，查询缓存也许引起性能下降而不是性能提升。</li> <li><code>max_connections</code> - 最大连接数，可设最大值 16384，一般考虑根据同时在线人数设置一个比较综合的数字，鉴于该数值增大并不太消耗系统资源，建议直接设 10000。如果在访问时经常出现 Too Many Connections 的错误提示，则需要增大该参数值</li> <li><code>thread_cache</code> - 当客户端断开之后，服务器处理此客户的线程将会缓存起来以响应下一个客户而不是销毁。可重用，减小了系统开销。默认值为 9，建议值：两种取值方式，
<ul><li>方式一，根据物理内存，1G —&gt; 8；2G —&gt; 16； 3G —&gt; 32； &gt;3G —&gt; 64；</li> <li>方式二，根据 show status like 'threads%'，查看 Threads_connected 值。</li></ul></li> <li><code>open_files_limit</code> - MySQL 打开的文件描述符限制，默认最小 1024;
<ul><li>当 open_files_limit 没有被配置的时候，比较 max_connections*5 和 ulimit -n 的值，哪个大用哪个，</li> <li>当 open_file_limit 被配置的时候，比较 open_files_limit 和 max_connections*5 的值，哪个大用哪个</li> <li>注意：仍然可能出现报错信息 Can't create a new thread；此时观察系统 <code>cat /proc/mysql</code> 进程号/limits，观察进程 ulimit 限制情况</li> <li>过小的话，考虑修改系统配置表，<code>/etc/security/limits.conf</code> 和 <code>/etc/security/limits.d/90-nproc.conf</code></li></ul></li></ul></li></ul> <h2 id="_4-常见问题"><a href="#_4-常见问题" class="header-anchor">#</a> 4. 常见问题</h2> <h3 id="_4-1-too-many-connections"><a href="#_4-1-too-many-connections" class="header-anchor">#</a> 4.1. Too many connections</h3> <p><strong>现象</strong></p> <p>尝试连接 Mysql 时，遇到 <code>Too many connections</code> 错误。</p> <p><strong>原因</strong></p> <p>数据库连接线程数超过最大值，访问被拒绝。</p> <p><strong>解决方案</strong></p> <p>如果实际连接线程数过大，可以考虑增加服务器节点来分流；如果实际线程数并不算过大，那么可以配置 <code>max_connections</code> 来增加允许的最大连接数。需要注意的是，连接数不宜过大，一般来说，单库每秒有 2000 个并发连接时，就可以考虑扩容了，健康的状态应该维持在每秒 1000 个并发连接左右。</p> <p>（1）查看最大连接数</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%max_connections%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token operator">|</span> Variable_name          <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
<span class="token operator">|</span> max_connections        <span class="token operator">|</span> <span class="token number">151</span>   <span class="token operator">|</span>
<span class="token operator">|</span> mysqlx_max_connections <span class="token operator">|</span> <span class="token number">100</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+-------+</span>
</code></pre></div><p>（2）查看服务器响应的最大连接数</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">global</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'Max_used_connections'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> Variable_name        <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> Max_used_connections <span class="token operator">|</span> <span class="token number">142</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>（3）临时设置最大连接数</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">GLOBAL</span> max_connections<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：当服务器重启时，最大连接数会被重置。</p> <p>（4）永久设置最大连接数</p> <p>修改 <code>/etc/my.cnf</code> 配置文件，在 <code>[mysqld]</code> 添加以下配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>max_connections<span class="token operator">=</span><span class="token number">256</span>
</code></pre></div><p>重启 mysql 以生效</p> <p>（5）修改 Linux 最大文件数限制</p> <p>设置了最大连接数，如果还是没有生效，考虑检查一下 Linux 最大文件数</p> <p>Mysql 最大连接数会受到最大文件数限制，<code>vim /etc/security/limits.conf</code>，添加 mysql 用户配置</p> <div class="language- extra-class"><pre class="language-text"><code>mysql hard nofile 65535
mysql soft nofile 65535
</code></pre></div><p>（6）检查 LimitNOFILE</p> <p>如果是使用 rpm 方式安装 mysql，检查 <strong>mysqld.service</strong> 文件中的 <code>LimitNOFILE</code> 是否配置的太小。</p> <h3 id="_4-2-时区-time-zone-偏差"><a href="#_4-2-时区-time-zone-偏差" class="header-anchor">#</a> 4.2. 时区（time_zone）偏差</h3> <p><strong>现象</strong></p> <p>数据库中存储的 Timestamp 字段值比真实值少了 13 个小时。</p> <p><strong>原因</strong></p> <ul><li>当 JDBC 与 MySQL 开始建立连接时，会获取服务器参数。</li> <li>当 MySQL 的 <code>time_zone</code> 值为 <code>SYSTEM</code> 时，会取 <code>system_time_zone</code> 值作为协调时区，若得到的是 <code>CST</code> 那么 Java 会误以为这是 <code>CST -0500</code> ，因此会给出错误的时区信息（国内一般是<code>CST +0800</code>，即东八区）。</li></ul> <p>查看时区方法：</p> <p>通过 <code>show variables like '%time_zone%';</code> 命令查看 Mysql 时区配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%time_zone%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+--------+</span>
<span class="token operator">|</span> Variable_name    <span class="token operator">|</span> <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+--------+</span>
<span class="token operator">|</span> system_time_zone <span class="token operator">|</span> CST    <span class="token operator">|</span>
<span class="token operator">|</span> time_zone        <span class="token operator">|</span> SYSTEM <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+--------+</span>
</code></pre></div><p><strong>解决方案</strong></p> <p>方案一</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> time_zone <span class="token operator">=</span> <span class="token string">'+08:00'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> time_zone <span class="token operator">=</span> <span class="token string">'+08:00'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>方案二</p> <p>修改 <code>my.cnf</code> 文件，在 <code>[mysqld]</code> 节下增加 <code>default-time-zone='+08:00'</code> ，然后重启。</p> <h3 id="_4-3-数据表损坏如何修复"><a href="#_4-3-数据表损坏如何修复" class="header-anchor">#</a> 4.3. 数据表损坏如何修复</h3> <p>使用 myisamchk 来修复，具体步骤：</p> <ol><li>修复前将 mysql 服务停止。</li> <li>打开命令行方式，然后进入到 mysql 的 <code>bin</code> 目录。</li> <li>执行 myisamchk –recover 数据库所在路 /*.MYI</li></ol> <p>使用 repair table 或者 OPTIMIZE table 命令来修复，REPAIR TABLE table_name 修复表 OPTIMIZE TABLE table_name 优化表 REPAIR TABLE 用于修复被破坏的表。 OPTIMIZE TABLE 用于回收闲置的数据库空间，当表上的数据行被删除时，所占据的磁盘空间并没有立即被回收，使用了 OPTIMIZE TABLE 命令后这些空间将被回收，并且对磁盘上的数据行进行重排（注意：是磁盘上，而非数据库）</p> <h3 id="_4-4-数据结构"><a href="#_4-4-数据结构" class="header-anchor">#</a> 4.4. 数据结构</h3> <blockquote><p>问题现象：ERROR 1071: Specified key was too long; max key length is 767 bytes</p></blockquote> <p>问题原因：Mysql 默认情况下单个列的索引不能超过 767 位（不同版本可能存在差异） 。</p> <p>解决方法：优化索引结构，索引字段不宜过长。</p> <h2 id="_5-脚本"><a href="#_5-脚本" class="header-anchor">#</a> 5. 脚本</h2> <p>这里推荐我写的几个一键运维脚本，非常方便，欢迎使用：</p> <ul><li><a href="https://github.com/dunwu/linux-tutorial/tree/master/codes/linux/soft/mysql-install.sh" target="_blank" rel="noopener noreferrer">Mysql 安装脚本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/dunwu/linux-tutorial/tree/master/codes/linux/soft/mysql-backup.sh" target="_blank" rel="noopener noreferrer">Mysql 备份脚本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_6-参考资料"><a href="#_6-参考资料" class="header-anchor">#</a> 6. 参考资料</h2> <ul><li><a href="https://book.douban.com/subject/23008813/" target="_blank" rel="noopener noreferrer">《高性能 MySQL》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>https://www.cnblogs.com/xiaopotian/p/8196464.html</li> <li>https://www.cnblogs.com/bigbrotherer/p/7241845.html</li> <li>https://blog.csdn.net/managementandjava/article/details/80039650</li> <li>http://www.manongjc.com/article/6996.html</li> <li>https://www.cnblogs.com/xyabk/p/8967990.html</li> <li><a href="https://blog.csdn.net/zyhlwzy/article/details/80569422" target="_blank" rel="noopener noreferrer">MySQL 8.0 主从（Master-Slave）配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/58eb5d162f301e00624f014a" target="_blank" rel="noopener noreferrer">Mysql 主从同步实战<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/entry/5a0aa2026fb9a045132a369f" target="_blank" rel="noopener noreferrer">MySQL 备份和恢复机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <div class="page-slot page-slot-bottom">
  <div class="wwads-cn wwads-horizontal pageB" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .pageB img{width:80px!important;}
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{line-height:1;}
  </style>
  </div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/db-tutorial/edit/master/docs/12.数据库/03.关系型数据库/02.Mysql/20.Mysql运维.md" target="_blank" rel="noopener noreferrer">📝 帮助改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/db-tutorial/tags/?tag=%E6%95%B0%E6%8D%AE%E5%BA%93" title="标签">#数据库</a><a href="/db-tutorial/tags/?tag=%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93" title="标签">#关系型数据库</a><a href="/db-tutorial/tags/?tag=Mysql" title="标签">#Mysql</a><a href="/db-tutorial/tags/?tag=%E8%BF%90%E7%BB%B4" title="标签">#运维</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/02/10, 11:43:21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/db-tutorial/pages/396816/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Mysql 性能优化</div></a> <a href="/db-tutorial/pages/5da42d/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Mysql 配置</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/db-tutorial/pages/396816/" class="prev">Mysql 性能优化</a></span> <span class="next"><a href="/db-tutorial/pages/5da42d/">Mysql 配置</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/db-tutorial/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/db-tutorial/pages/d1bae4/"><div>
            Elasticsearch 映射
            <!----></div></a> <span class="date">05-16</span></dt></dl><dl><dd>02</dd> <dt><a href="/db-tutorial/pages/3c3c45/"><div>
            数据库综合
            <!----></div></a> <span class="date">04-11</span></dt></dl><dl><dd>03</dd> <dt><a href="/db-tutorial/pages/addb05/"><div>
            数据库中间件和代理
            <!----></div></a> <span class="date">04-11</span></dt></dl> <dl><dd></dd> <dt><a href="/db-tutorial/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:forbreak@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/dunwu" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>钝悟（dunwu） | CC-BY-SA-4.0</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="136" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 10px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/db-tutorial/assets/js/app.1598b197.js" defer></script><script src="/db-tutorial/assets/js/2.cc645ea8.js" defer></script><script src="/db-tutorial/assets/js/22.08afd969.js" defer></script>
  </body>
</html>
